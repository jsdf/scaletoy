(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{59:function(t,e,i){"use strict";(function(t){var n=i(62),o=function t(){if(!(this instanceof t))throw new Error("constructor needs to be called with the 'new' keyword")};o.prototype.toString=function(){for(var t in o){var e=t[0].match(/^[A-Z]$/),i=o[t]===this.constructor;if(o.isFunction(o[t])&&e&&i)return t}return"Tone"},o.prototype.dispose=function(){return this},o.prototype.set=function(t,e){if(o.isString(t)){var i={};i[t]=e,t=i}t:for(var n in t){e=t[n];var s=this;if(-1!==n.indexOf(".")){for(var r=n.split("."),a=0;a<r.length-1;a++)if((s=s[r[a]])instanceof o){r.splice(0,a+1);var u=r.join(".");s.set(u,e);continue t}n=r[r.length-1]}var h=s[n];o.isUndef(h)||(o.Signal&&h instanceof o.Signal||o.Param&&h instanceof o.Param?h.value!==e&&(h.value=e):h instanceof AudioParam?h.value!==e&&(h.value=e):o.TimeBase&&h instanceof o.TimeBase?s[n]=e:h instanceof o?h.set(e):h!==e&&(s[n]=e))}return this},o.prototype.get=function(t){o.isUndef(t)?t=this._collectDefaults(this.constructor):o.isString(t)&&(t=[t]);for(var e={},i=0;i<t.length;i++){var n=t[i],s=this,r=e;if(-1!==n.indexOf(".")){for(var a=n.split("."),u=0;u<a.length-1;u++){var h=a[u];r[h]=r[h]||{},r=r[h],s=s[h]}n=a[a.length-1]}var c=s[n];o.isObject(t[n])?r[n]=c.get():o.Signal&&c instanceof o.Signal?r[n]=c.value:o.Param&&c instanceof o.Param?r[n]=c.value:c instanceof AudioParam?r[n]=c.value:c instanceof o?r[n]=c.get():!o.isFunction(c)&&o.isDefined(c)&&(r[n]=c)}return e},o.prototype._collectDefaults=function(t){var e=[];if(o.isDefined(t.defaults)&&(e=Object.keys(t.defaults)),o.isDefined(t._super))for(var i=this._collectDefaults(t._super),n=0;n<i.length;n++)-1===e.indexOf(i[n])&&e.push(i[n]);return e},o.defaults=function(t,e,i){var n={};if(1===t.length&&o.isObject(t[0]))n=t[0];else for(var s=0;s<e.length;s++)n[e[s]]=t[s];return o.isDefined(i.defaults)?o.defaultArg(n,i.defaults):o.isObject(i)?o.defaultArg(n,i):n},o.defaultArg=function(t,e){if(o.isObject(t)&&o.isObject(e)){var i={};for(var n in t)i[n]=o.defaultArg(e[n],t[n]);for(var s in e)i[s]=o.defaultArg(t[s],e[s]);return i}return o.isUndef(t)?e:t},o.prototype.log=function(){if(this.debug||this.toString()===o.global.TONE_DEBUG_CLASS){var t=Array.from(arguments);t.unshift(this.toString()+":"),console.log.apply(void 0,t)}},o.prototype.assert=function(t,e){if(!t)throw new Error(e)},o.connectSeries=function(){for(var t=arguments[0],e=1;e<arguments.length;e++){var i=arguments[e];o.connect(t,i),t=i}return o},o.connect=function(t,e,i,n){for(;o.isDefined(e.input);)o.isArray(e.input)?(n=o.defaultArg(n,0),e=e.input[n],n=0):e.input&&(e=e.input);return e instanceof AudioParam?t.connect(e,i):e instanceof AudioNode&&t.connect(e,i,n),o},o.disconnect=function(t,e,i,n){if(e){for(var s=!1;!s;)o.isArray(e.input)?(o.isDefined(n)?o.disconnect(t,e.input[n],i):e.input.forEach(function(e){try{o.disconnect(t,e,i)}catch(n){}}),s=!0):e.input?e=e.input:s=!0;e instanceof AudioParam?t.disconnect(e,i):e instanceof AudioNode&&t.disconnect(e,i,n)}else t.disconnect();return o},o.isUndef=function(t){return"undefined"===typeof t},o.isDefined=function(t){return!o.isUndef(t)},o.isFunction=function(t){return"function"===typeof t},o.isNumber=function(t){return"number"===typeof t},o.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object},o.isBoolean=function(t){return"boolean"===typeof t},o.isArray=function(t){return Array.isArray(t)},o.isString=function(t){return"string"===typeof t},o.isNote=function(t){return o.isString(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)},o.noOp=function(){},o.prototype._readOnly=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._readOnly(t[e]);else Object.defineProperty(this,t,{writable:!1,enumerable:!0})},o.prototype._writable=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._writable(t[e]);else Object.defineProperty(this,t,{writable:!0})},o.State={Started:"started",Stopped:"stopped",Paused:"paused"},o.global=o.isUndef(t)?window:t,o.equalPowerScale=function(t){var e=.5*Math.PI;return Math.sin(t*e)},o.dbToGain=function(t){return Math.pow(10,t/20)},o.gainToDb=function(t){return Math.log(t)/Math.LN10*20},o.intervalToFrequencyRatio=function(t){return Math.pow(2,t/12)},o.prototype.now=function(){return o.context.now()},o.now=function(){return o.context.now()},o.prototype.immediate=function(){return o.context.currentTime},o.immediate=function(){return o.context.currentTime},o.extend=function(t,e){function i(){}o.isUndef(e)&&(e=o),i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t._super=e},o._audioContext=null,o.start=function(){return o.context.resume()},Object.defineProperty(o,"context",{get:function(){return o._audioContext},set:function(t){o._audioContext=t.isContext?t:new o.Context(t),o.Context.emit("init",o._audioContext)}}),Object.defineProperty(o.prototype,"context",{get:function(){return o.context}}),o.setContext=function(t){o.context=t},Object.defineProperty(o.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(o.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(o,"supported",{get:function(){var t=o.global.hasOwnProperty("AudioContext")||o.global.hasOwnProperty("webkitAudioContext"),e=o.global.hasOwnProperty("Promise");return t&&e}}),Object.defineProperty(o,"initialized",{get:function(){return Boolean(o.context)}}),o.getContext=function(t){if(o.initialized)t(o.context);else{o.Context.on("init",function e(){t(o.context),o.Context.off("init",e)})}return o},o.version=n.a,e.a=o}).call(this,i(28))},60:function(t,e,i){"use strict";var n=i(59);i(61);n.a.Frequency=function(t,e){if(!(this instanceof n.a.Frequency))return new n.a.Frequency(t,e);n.a.TimeBase.call(this,t,e)},n.a.extend(n.a.Frequency,n.a.TimeBase),n.a.Frequency.prototype._expressions=Object.assign({},n.a.TimeBase.prototype._expressions,{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method:function(t){return"midi"===this._defaultUnits?t:n.a.Frequency.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(t,e){var i=o[t.toLowerCase()]+12*(parseInt(e)+1);return"midi"===this._defaultUnits?i:n.a.Frequency.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(t,e,i){var n=1;return t&&"0"!==t&&(n*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(n*=this._beatsToUnits(parseFloat(e))),i&&"0"!==i&&(n*=this._beatsToUnits(parseFloat(i)/4)),n}}}),n.a.Frequency.prototype.transpose=function(t){return new this.constructor(this.valueOf()*n.a.intervalToFrequencyRatio(t))},n.a.Frequency.prototype.harmonize=function(t){return t.map(function(t){return this.transpose(t)}.bind(this))},n.a.Frequency.prototype.toMidi=function(){return n.a.Frequency.ftom(this.valueOf())},n.a.Frequency.prototype.toNote=function(){var t=this.toFrequency(),e=Math.log2(t/n.a.Frequency.A4),i=Math.round(12*e)+57,o=Math.floor(i/12);return o<0&&(i+=-12*o),s[i%12]+o.toString()},n.a.Frequency.prototype.toSeconds=function(){return 1/n.a.TimeBase.prototype.toSeconds.call(this)},n.a.Frequency.prototype.toFrequency=function(){return n.a.TimeBase.prototype.toFrequency.call(this)},n.a.Frequency.prototype.toTicks=function(){var t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*n.a.Transport.PPQ)},n.a.Frequency.prototype._noArg=function(){return 0},n.a.Frequency.prototype._frequencyToUnits=function(t){return t},n.a.Frequency.prototype._ticksToUnits=function(t){return 1/(60*t/(n.a.Transport.bpm.value*n.a.Transport.PPQ))},n.a.Frequency.prototype._beatsToUnits=function(t){return 1/n.a.TimeBase.prototype._beatsToUnits.call(this,t)},n.a.Frequency.prototype._secondsToUnits=function(t){return 1/t},n.a.Frequency.prototype._defaultUnits="hz";var o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];n.a.Frequency.A4=440,n.a.Frequency.mtof=function(t){return n.a.Frequency.A4*Math.pow(2,(t-69)/12)},n.a.Frequency.ftom=function(t){return 69+Math.round(12*Math.log2(t/n.a.Frequency.A4))},e.a=n.a.Frequency},61:function(t,e,i){"use strict";var n=i(59);n.a.TimeBase=function(t,e){if(!(this instanceof n.a.TimeBase))return new n.a.TimeBase(t,e);if(this._val=t,this._units=e,n.a.isUndef(this._units)&&n.a.isString(this._val)&&parseFloat(this._val)==this._val&&"+"!==this._val.charAt(0))this._val=parseFloat(this._val),this._units=this._defaultUnits;else if(t&&t.constructor===this.constructor)this._val=t._val,this._units=t._units;else if(t instanceof n.a.TimeBase)switch(this._defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi();break;default:throw new Error("Unrecognized default units "+this._defaultUnits)}},n.a.extend(n.a.TimeBase),n.a.TimeBase.prototype._expressions={n:{regexp:/^(\d+)n(\.?)$/i,method:function(t,e){var i="."===e?1.5:1;return 1===(t=parseInt(t))?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/t)*i}},t:{regexp:/^(\d+)t$/i,method:function(t){return t=parseInt(t),this._beatsToUnits(8/(3*parseInt(t)))}},m:{regexp:/^(\d+)m$/i,method:function(t){return this._beatsToUnits(parseInt(t)*this._getTimeSignature())}},i:{regexp:/^(\d+)i$/i,method:function(t){return this._ticksToUnits(parseInt(t))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz$/i,method:function(t){return this._frequencyToUnits(parseFloat(t))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/,method:function(t,e,i){var n=0;return t&&"0"!==t&&(n+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(n+=this._beatsToUnits(parseFloat(e))),i&&"0"!==i&&(n+=this._beatsToUnits(parseFloat(i)/4)),n}},s:{regexp:/^(\d+(?:\.\d+)?)s$/,method:function(t){return this._secondsToUnits(parseFloat(t))}},samples:{regexp:/^(\d+)samples$/,method:function(t){return parseInt(t)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)$/,method:function(t){return this._expressions[this._defaultUnits].method.call(this,t)}}},n.a.TimeBase.prototype._defaultUnits="s",n.a.TimeBase.prototype._getBpm=function(){return n.a.Transport?n.a.Transport.bpm.value:120},n.a.TimeBase.prototype._getTimeSignature=function(){return n.a.Transport?n.a.Transport.timeSignature:4},n.a.TimeBase.prototype._getPPQ=function(){return n.a.Transport?n.a.Transport.PPQ:192},n.a.TimeBase.prototype._now=function(){return this.now()},n.a.TimeBase.prototype._frequencyToUnits=function(t){return 1/t},n.a.TimeBase.prototype._beatsToUnits=function(t){return 60/this._getBpm()*t},n.a.TimeBase.prototype._secondsToUnits=function(t){return t},n.a.TimeBase.prototype._ticksToUnits=function(t){return t*(this._beatsToUnits(1)/this._getPPQ())},n.a.TimeBase.prototype._noArg=function(){return this._now()},n.a.TimeBase.prototype.valueOf=function(){if(n.a.isUndef(this._val))return this._noArg();if(n.a.isString(this._val)&&n.a.isUndef(this._units)){for(var t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(n.a.isObject(this._val)){var e=0;for(var i in this._val){var o=this._val[i];e+=new this.constructor(i).valueOf()*o}return e}if(n.a.isDefined(this._units)){var s=this._expressions[this._units],r=this._val.toString().trim().match(s.regexp);return r?s.method.apply(this,r.slice(1)):s.method.call(this,parseFloat(this._val))}return this._val},n.a.TimeBase.prototype.toSeconds=function(){return this.valueOf()},n.a.TimeBase.prototype.toFrequency=function(){return 1/this.toSeconds()},n.a.TimeBase.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},n.a.TimeBase.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},n.a.TimeBase.prototype.dispose=function(){this._val=null,this._units=null};n.a.TimeBase},62:function(t,e,i){"use strict";e.a="13.8.22"},67:function(t,e,i){"use strict";var n=i(59);i(61),i(60);n.a.Time=function(t,e){if(!(this instanceof n.a.Time))return new n.a.Time(t,e);n.a.TimeBase.call(this,t,e)},n.a.extend(n.a.Time,n.a.TimeBase),n.a.Time.prototype._expressions=Object.assign({},n.a.TimeBase.prototype._expressions,{quantize:{regexp:/^@(.+)/,method:function(t){if(n.a.Transport){var e=new this.constructor(t);return this._secondsToUnits(n.a.Transport.nextSubdivision(e))}return 0}},now:{regexp:/^\+(.+)/,method:function(t){return this._now()+new this.constructor(t)}}}),n.a.Time.prototype.quantize=function(t,e){e=n.a.defaultArg(e,1);var i=new this.constructor(t),o=this.valueOf();return o+(Math.round(o/i)*i-o)*e},n.a.Time.prototype.toNotation=function(){for(var t=this.toSeconds(),e=["1m"],i=1;i<8;i++){var o=Math.pow(2,i);e.push(o+"n."),e.push(o+"n"),e.push(o+"t")}e.push("0");var s=e[0],r=n.a.Time(e[0]).toSeconds();return e.forEach(function(e){var i=n.a.Time(e).toSeconds();Math.abs(i-t)<Math.abs(r-t)&&(s=e,r=i)}),s},n.a.Time.prototype.toBarsBeatsSixteenths=function(){var t=this._beatsToUnits(1),e=this.valueOf()/t;e=parseFloat(e.toFixed(4));var i=Math.floor(e/this._getTimeSignature()),n=e%1*4;return e=Math.floor(e)%this._getTimeSignature(),(n=n.toString()).length>3&&(n=parseFloat(parseFloat(n).toFixed(3))),[i,e,n].join(":")},n.a.Time.prototype.toTicks=function(){var t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())},n.a.Time.prototype.toSeconds=function(){return this.valueOf()},n.a.Time.prototype.toMidi=function(){return n.a.Frequency.ftom(this.toFrequency())};n.a.Time;n.a.TransportTime=function(t,e){if(!(this instanceof n.a.TransportTime))return new n.a.TransportTime(t,e);n.a.Time.call(this,t,e)},n.a.extend(n.a.TransportTime,n.a.Time),n.a.TransportTime.prototype._now=function(){return n.a.Transport.seconds};n.a.TransportTime;n.a.Emitter=function(){n.a.call(this),this._events={}},n.a.extend(n.a.Emitter),n.a.Emitter.prototype.on=function(t,e){for(var i=t.split(/\W+/),n=0;n<i.length;n++){var o=i[n];this._events.hasOwnProperty(o)||(this._events[o]=[]),this._events[o].push(e)}return this},n.a.Emitter.prototype.once=function(t,e){var i=function(){e.apply(this,arguments),this.off(t,i)}.bind(this);return this.on(t,i),this},n.a.Emitter.prototype.off=function(t,e){for(var i=t.split(/\W+/),o=0;o<i.length;o++)if(t=i[o],this._events.hasOwnProperty(t))if(n.a.isUndef(e))this._events[t]=[];else for(var s=this._events[t],r=0;r<s.length;r++)s[r]===e&&s.splice(r,1);return this},n.a.Emitter.prototype.emit=function(t){if(this._events){var e=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(t))for(var i=this._events[t].slice(0),n=0,o=i.length;n<o;n++)i[n].apply(this,e)}return this},n.a.Emitter.mixin=function(t){var e=["on","once","off","emit"];t._events={};for(var i=0;i<e.length;i++){var o=e[i],s=n.a.Emitter.prototype[o];t[o]=s}return n.a.Emitter},n.a.Emitter.prototype.dispose=function(){return n.a.prototype.dispose.call(this),this._events=null,this};n.a.Emitter;n.a.Timeline=function(){var t=n.a.defaults(arguments,["memory"],n.a.Timeline);n.a.call(this),this._timeline=[],this.memory=t.memory},n.a.extend(n.a.Timeline),n.a.Timeline.defaults={memory:1/0},Object.defineProperty(n.a.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),n.a.Timeline.prototype.add=function(t){if(n.a.isUndef(t.time))throw new Error("Tone.Timeline: events must have a time attribute");t.time=t.time.valueOf();var e=this._search(t.time);if(this._timeline.splice(e+1,0,t),this.length>this.memory){var i=this.length-this.memory;this._timeline.splice(0,i)}return this},n.a.Timeline.prototype.remove=function(t){var e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this},n.a.Timeline.prototype.get=function(t,e){e=n.a.defaultArg(e,"time");var i=this._search(t,e);return-1!==i?this._timeline[i]:null},n.a.Timeline.prototype.peek=function(){return this._timeline[0]},n.a.Timeline.prototype.shift=function(){return this._timeline.shift()},n.a.Timeline.prototype.getAfter=function(t,e){e=n.a.defaultArg(e,"time");var i=this._search(t,e);return i+1<this._timeline.length?this._timeline[i+1]:null},n.a.Timeline.prototype.getBefore=function(t,e){e=n.a.defaultArg(e,"time");var i=this._timeline.length;if(i>0&&this._timeline[i-1][e]<t)return this._timeline[i-1];var o=this._search(t,e);return o-1>=0?this._timeline[o-1]:null},n.a.Timeline.prototype.cancel=function(t){if(this._timeline.length>1){var e=this._search(t);if(e>=0)if(this._timeline[e].time===t){for(var i=e;i>=0&&this._timeline[i].time===t;i--)e=i;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=t&&(this._timeline=[]);return this},n.a.Timeline.prototype.cancelBefore=function(t){var e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this},n.a.Timeline.prototype.previousEvent=function(t){var e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null},n.a.Timeline.prototype._search=function(t,e){if(0===this._timeline.length)return-1;e=n.a.defaultArg(e,"time");var i=0,o=this._timeline.length,s=o;if(o>0&&this._timeline[o-1][e]<=t)return o-1;for(;i<s;){var r=Math.floor(i+(s-i)/2),a=this._timeline[r],u=this._timeline[r+1];if(a[e]===t){for(var h=r;h<this._timeline.length;h++){this._timeline[h][e]===t&&(r=h)}return r}if(a[e]<t&&u[e]>t)return r;a[e]>t?s=r:i=r+1}return-1},n.a.Timeline.prototype._iterate=function(t,e,i){e=n.a.defaultArg(e,0),i=n.a.defaultArg(i,this._timeline.length-1),this._timeline.slice(e,i+1).forEach(function(e){t.call(this,e)}.bind(this))},n.a.Timeline.prototype.forEach=function(t){return this._iterate(t),this},n.a.Timeline.prototype.forEachBefore=function(t,e){var i=this._search(t);return-1!==i&&this._iterate(e,0,i),this},n.a.Timeline.prototype.forEachAfter=function(t,e){var i=this._search(t);return this._iterate(e,i+1),this},n.a.Timeline.prototype.forEachBetween=function(t,e,i){var n=this._search(t),o=this._search(e);return-1!==n&&-1!==o?(this._timeline[n].time!==t&&(n+=1),this._timeline[o].time===e&&(o-=1),this._iterate(i,n,o)):-1===n&&this._iterate(i,0,o),this},n.a.Timeline.prototype.forEachFrom=function(t,e){for(var i=this._search(t);i>=0&&this._timeline[i].time>=t;)i--;return this._iterate(e,i+1),this},n.a.Timeline.prototype.forEachAtTime=function(t,e){var i=this._search(t);return-1!==i&&this._iterate(function(i){i.time===t&&e.call(this,i)},0,i),this},n.a.Timeline.prototype.dispose=function(){return n.a.prototype.dispose.call(this),this._timeline=null,this};n.a.Timeline;if(n.a.supported){!n.a.global.hasOwnProperty("OfflineAudioContext")&&n.a.global.hasOwnProperty("webkitOfflineAudioContext")&&(n.a.global.OfflineAudioContext=n.a.global.webkitOfflineAudioContext);var o=new OfflineAudioContext(1,1,44100).startRendering();o&&n.a.isFunction(o.then)||(OfflineAudioContext.prototype._native_startRendering=OfflineAudioContext.prototype.startRendering,OfflineAudioContext.prototype.startRendering=function(){return new Promise(function(t){this.oncomplete=function(e){t(e.renderedBuffer)},this._native_startRendering()}.bind(this))})}if(n.a.supported){!n.a.global.hasOwnProperty("AudioContext")&&n.a.global.hasOwnProperty("webkitAudioContext")&&(n.a.global.AudioContext=n.a.global.webkitAudioContext),AudioContext.prototype.close||(AudioContext.prototype.close=function(){return n.a.isFunction(this.suspend)&&this.suspend(),Promise.resolve()}),AudioContext.prototype.resume||(AudioContext.prototype.resume=function(){var t=this.createBuffer(1,1,this.sampleRate),e=this.createBufferSource();return e.buffer=t,e.connect(this.destination),e.start(0),Promise.resolve()}),!AudioContext.prototype.createGain&&AudioContext.prototype.createGainNode&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),!AudioContext.prototype.createDelay&&AudioContext.prototype.createDelayNode&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode);var s=!1,r=new OfflineAudioContext(1,1,44100),a=new Uint32Array([1179011410,48,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,8,0,0,0,0]).buffer;try{var u=r.decodeAudioData(a);u&&n.a.isFunction(u.then)&&(s=!0)}catch(A){s=!1}s||(AudioContext.prototype._native_decodeAudioData=AudioContext.prototype.decodeAudioData,AudioContext.prototype.decodeAudioData=function(t){return new Promise(function(e,i){this._native_decodeAudioData(t,e,i)}.bind(this))})}var h=["baseLatency","destination","currentTime","sampleRate","listener","state"],c=["suspend","close","resume","getOutputTimestamp","createMediaElementSource","createMediaStreamSource","createMediaStreamDestination","createBuffer","decodeAudioData","createBufferSource","createConstantSource","createGain","createDelay","createBiquadFilter","createIIRFilter","createWaveShaper","createPanner","createConvolver","createDynamicsCompressor","createAnalyser","createScriptProcessor","createStereoPanner","createOscillator","createPeriodicWave","createChannelSplitter","createChannelMerger","audioWorklet"];n.a.Context=function(){n.a.Emitter.call(this);var t=n.a.defaults(arguments,["context"],n.a.Context);if(!t.context&&(t.context=new n.a.global.AudioContext,!t.context))throw new Error("could not create AudioContext. Possibly too many AudioContexts running already.");for(this._context=t.context;this._context.rawContext;)this._context=this._context.rawContext;h.forEach(function(t){this._defineProperty(this._context,t)}.bind(this)),c.forEach(function(t){this._defineMethod(this._context,t)}.bind(this)),this._latencyHint=t.latencyHint,this._constants={},this.lookAhead=t.lookAhead,this._computedUpdateInterval=0,this._ticker=new l(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this._timeouts=new n.a.Timeline,this._timeoutIds=0,this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=function(t){this.emit("statechange",t)}.bind(this)},n.a.extend(n.a.Context,n.a.Emitter),n.a.Emitter.mixin(n.a.Context),n.a.Context.defaults={clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.03},n.a.Context.prototype.isContext=!0,n.a.Context.prototype._defineProperty=function(t,e){n.a.isUndef(this[e])&&Object.defineProperty(this,e,{get:function(){return t[e]},set:function(i){t[e]=i}})},n.a.Context.prototype._defineMethod=function(t,e){n.a.isUndef(this[e])&&Object.defineProperty(this,e,{get:function(){return t[e].bind(t)}})},n.a.Context.prototype.now=function(){return this._context.currentTime+this.lookAhead},Object.defineProperty(n.a.Context.prototype,"destination",{get:function(){return this.master?this.master:this._context.destination}}),n.a.Context.prototype.resume=function(){return"suspended"===this._context.state&&this._context instanceof AudioContext?this._context.resume():Promise.resolve()},n.a.Context.prototype.close=function(){var t=Promise.resolve();return this!==n.a.global.TONE_AUDIO_CONTEXT&&(t=this.rawContext.close()),t.then(function(){n.a.Context.emit("close",this)}.bind(this))},n.a.Context.prototype.getConstant=function(t){if(this._constants[t])return this._constants[t];for(var e=this._context.createBuffer(1,128,this._context.sampleRate),i=e.getChannelData(0),n=0;n<i.length;n++)i[n]=t;var o=this._context.createBufferSource();return o.channelCount=1,o.channelCountMode="explicit",o.buffer=e,o.loop=!0,o.start(0),this._constants[t]=o,o},n.a.Context.prototype._timeoutLoop=function(){for(var t=this.now();this._timeouts&&this._timeouts.length&&this._timeouts.peek().time<=t;)this._timeouts.shift().callback()},n.a.Context.prototype.setTimeout=function(t,e){this._timeoutIds++;var i=this.now();return this._timeouts.add({callback:t,time:i+e,id:this._timeoutIds}),this._timeoutIds},n.a.Context.prototype.clearTimeout=function(t){return this._timeouts.forEach(function(e){e.id===t&&this.remove(e)}),this},Object.defineProperty(n.a.Context.prototype,"updateInterval",{get:function(){return this._ticker.updateInterval},set:function(t){this._ticker.updateInterval=t}}),Object.defineProperty(n.a.Context.prototype,"rawContext",{get:function(){return this._context}}),Object.defineProperty(n.a.Context.prototype,"clockSource",{get:function(){return this._ticker.type},set:function(t){this._ticker.type=t}}),Object.defineProperty(n.a.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(t){var e=t;if(this._latencyHint=t,n.a.isString(t))switch(t){case"interactive":e=.1,this._context.latencyHint=t;break;case"playback":e=.8,this._context.latencyHint=t;break;case"balanced":e=.25,this._context.latencyHint=t;break;case"fastest":this._context.latencyHint="interactive",e=.01}this.lookAhead=e,this.updateInterval=e/3}}),n.a.Context.prototype.dispose=function(){return this.close().then(function(){for(var t in n.a.Emitter.prototype.dispose.call(this),this._ticker.dispose(),this._ticker=null,this._timeouts.dispose(),this._timeouts=null,this._constants)this._constants[t].disconnect();this._constants=null}.bind(this))};var l=function(t,e,i){this._type=e,this._updateInterval=i,this._callback=n.a.defaultArg(t,n.a.noOp),this._createClock()};if(l.Type={Worker:"worker",Timeout:"timeout",Offline:"offline"},l.prototype._createWorker=function(){n.a.global.URL=n.a.global.URL||n.a.global.webkitURL;var t=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),e=URL.createObjectURL(t),i=new Worker(e);i.onmessage=this._callback.bind(this),this._worker=i},l.prototype._createTimeout=function(){this._timeout=setTimeout(function(){this._createTimeout(),this._callback()}.bind(this),1e3*this._updateInterval)},l.prototype._createClock=function(){if(this._type===l.Type.Worker)try{this._createWorker()}catch(A){this._type=l.Type.Timeout,this._createClock()}else this._type===l.Type.Timeout&&this._createTimeout()},Object.defineProperty(l.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(t){this._updateInterval=Math.max(t,128/44100),this._type===l.Type.Worker&&this._worker.postMessage(Math.max(1e3*t,1))}}),Object.defineProperty(l.prototype,"type",{get:function(){return this._type},set:function(t){this._disposeClock(),this._type=t,this._createClock()}}),l.prototype._disposeClock=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._worker&&(this._worker.terminate(),this._worker.onmessage=null,this._worker=null)},l.prototype.dispose=function(){this._disposeClock(),this._callback=null},n.a.supported&&!n.a.initialized){if(n.a.global.TONE_AUDIO_CONTEXT||(n.a.global.TONE_AUDIO_CONTEXT=new n.a.Context),n.a.context=n.a.global.TONE_AUDIO_CONTEXT,!n.a.global.TONE_SILENCE_LOGGING){var p="v";"dev"===n.a.version&&(p="");var f=" * Tone.js "+p+n.a.version+" * ";console.log("%c"+f,"background: #000; color: #fff")}}else n.a.supported||n.a.global.TONE_SILENCE_LOGGING||console.warn("This browser does not support Tone.js");n.a.Context;n.a.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Gain:"gain",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},n.a.prototype.toSeconds=function(t){return n.a.isNumber(t)?t:n.a.isUndef(t)?this.now():n.a.isString(t)||n.a.isObject(t)?new n.a.Time(t).toSeconds():t instanceof n.a.TimeBase?t.toSeconds():void 0},n.a.prototype.toFrequency=function(t){return n.a.isNumber(t)?t:n.a.isString(t)||n.a.isUndef(t)||n.a.isObject(t)?new n.a.Frequency(t).valueOf():t instanceof n.a.TimeBase?t.toFrequency():void 0},n.a.prototype.toTicks=function(t){return n.a.isNumber(t)||n.a.isString(t)||n.a.isObject(t)?new n.a.TransportTime(t).toTicks():n.a.isUndef(t)?n.a.Transport.ticks:t instanceof n.a.TimeBase?t.toTicks():void 0};n.a;if(n.a.supported){var d=new OfflineAudioContext(2,1,44100),m=d.createGain(),_=d.createGain();if(m.connect(_)!==_){var y=AudioNode.prototype.connect;AudioNode.prototype.connect=function(){return y.apply(this,arguments),arguments[0]}}}n.a.AudioNode=function(){n.a.call(this);var t=n.a.defaults(arguments,["context"],{context:n.a.context});this._context=t.context},n.a.extend(n.a.AudioNode),Object.defineProperty(n.a.AudioNode.prototype,"context",{get:function(){return this._context}}),n.a.AudioNode.prototype.createInsOuts=function(t,e){1===t?this.input=this.context.createGain():t>1&&(this.input=new Array(t)),1===e?this.output=this.context.createGain():e>1&&(this.output=new Array(e))},Object.defineProperty(n.a.AudioNode.prototype,"channelCount",{get:function(){return this.output.channelCount},set:function(t){return this.output.channelCount=t}}),Object.defineProperty(n.a.AudioNode.prototype,"channelCountMode",{get:function(){return this.output.channelCountMode},set:function(t){return this.output.channelCountMode=t}}),Object.defineProperty(n.a.AudioNode.prototype,"channelInterpretation",{get:function(){return this.output.channelInterpretation},set:function(t){return this.output.channelInterpretation=t}}),Object.defineProperty(n.a.AudioNode.prototype,"numberOfInputs",{get:function(){return this.input?n.a.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(n.a.AudioNode.prototype,"numberOfOutputs",{get:function(){return this.output?n.a.isArray(this.output)?this.output.length:1:0}}),n.a.AudioNode.prototype.connect=function(t,e,i){return n.a.isArray(this.output)?(e=n.a.defaultArg(e,0),this.output[e].connect(t,0,i)):n.a.connect(this.output,t,e,i),this},n.a.AudioNode.prototype.disconnect=function(t,e,i){return n.a.isArray(this.output)?(e=n.a.defaultArg(e,0),this.output[e].disconnect(t,0,i)):n.a.disconnect(this.output,t,e,i),this},n.a.AudioNode.prototype.chain=function(){var t=Array.from(arguments);return t.unshift(this),n.a.connectSeries.apply(void 0,t),this},n.a.AudioNode.prototype.fan=function(){for(var t=0;t<arguments.length;t++)this.connect(arguments[t]);return this},n.a.AudioNode.prototype.dispose=function(){return n.a.isDefined(this.input)&&(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),n.a.isDefined(this.output)&&(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this._context=null,this};n.a.AudioNode;n.a.Param=function(){var t=n.a.defaults(arguments,["param","units","convert"],n.a.Param);n.a.AudioNode.call(this,t),this._param=this.input=t.param,this.units=t.units,this.convert=t.convert,this.overridden=!1,this._events=new n.a.Timeline(1e3),n.a.isDefined(t.value)&&this._param&&this.setValueAtTime(t.value,0)},n.a.extend(n.a.Param,n.a.AudioNode),n.a.Param.defaults={units:n.a.Type.Default,convert:!0,param:void 0},Object.defineProperty(n.a.Param.prototype,"value",{get:function(){var t=this.now();return this._toUnits(this.getValueAtTime(t))},set:function(t){this._initialValue=this._fromUnits(t),this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}}),Object.defineProperty(n.a.Param.prototype,"minValue",{get:function(){return this.units===n.a.Type.Time||this.units===n.a.Type.Frequency||this.units===n.a.Type.NormalRange||this.units===n.a.Type.Positive||this.units===n.a.Type.BPM?0:this.units===n.a.Type.AudioRange?-1:this.units===n.a.Type.Decibels?-1/0:this._param.minValue}}),Object.defineProperty(n.a.Param.prototype,"maxValue",{get:function(){return this.units===n.a.Type.NormalRange||this.units===n.a.Type.AudioRange?1:this._param.maxValue}}),n.a.Param.prototype._fromUnits=function(t){if(!this.convert&&!n.a.isUndef(this.convert)||this.overridden)return t;switch(this.units){case n.a.Type.Time:return this.toSeconds(t);case n.a.Type.Frequency:return this.toFrequency(t);case n.a.Type.Decibels:return n.a.dbToGain(t);case n.a.Type.NormalRange:return Math.min(Math.max(t,0),1);case n.a.Type.AudioRange:return Math.min(Math.max(t,-1),1);case n.a.Type.Positive:return Math.max(t,0);default:return t}},n.a.Param.prototype._toUnits=function(t){if(!this.convert&&!n.a.isUndef(this.convert))return t;switch(this.units){case n.a.Type.Decibels:return n.a.gainToDb(t);default:return t}},n.a.Param.prototype._minOutput=1e-5,n.a.Param.AutomationType={Linear:"linearRampToValueAtTime",Exponential:"exponentialRampToValueAtTime",Target:"setTargetAtTime",SetValue:"setValueAtTime",Cancel:"cancelScheduledValues"},n.a.Param.prototype.setValueAtTime=function(t,e){return e=this.toSeconds(e),t=this._fromUnits(t),this._events.add({type:n.a.Param.AutomationType.SetValue,value:t,time:e}),this.log(n.a.Param.AutomationType.SetValue,t,e),this._param.setValueAtTime(t,e),this},n.a.Param.prototype.getValueAtTime=function(t){t=this.toSeconds(t);var e=this._events.getAfter(t),i=this._events.get(t),o=n.a.defaultArg(this._initialValue,this._param.defaultValue),s=o;if(null===i)s=o;else if(i.type===n.a.Param.AutomationType.Target){var r,a=this._events.getBefore(i.time);r=null===a?o:a.value,s=this._exponentialApproach(i.time,r,i.value,i.constant,t)}else s=null===e?i.value:e.type===n.a.Param.AutomationType.Linear?this._linearInterpolate(i.time,i.value,e.time,e.value,t):e.type===n.a.Param.AutomationType.Exponential?this._exponentialInterpolate(i.time,i.value,e.time,e.value,t):i.value;return s},n.a.Param.prototype.setRampPoint=function(t){t=this.toSeconds(t);var e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===e&&(e=this._minOutput),this.setValueAtTime(this._toUnits(e),t),this},n.a.Param.prototype.linearRampToValueAtTime=function(t,e){return t=this._fromUnits(t),e=this.toSeconds(e),this._events.add({type:n.a.Param.AutomationType.Linear,value:t,time:e}),this.log(n.a.Param.AutomationType.Linear,t,e),this._param.linearRampToValueAtTime(t,e),this},n.a.Param.prototype.exponentialRampToValueAtTime=function(t,e){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),e=this.toSeconds(e),this._events.add({type:n.a.Param.AutomationType.Exponential,time:e,value:t}),this.log(n.a.Param.AutomationType.Exponential,t,e),this._param.exponentialRampToValueAtTime(t,e),this},n.a.Param.prototype.exponentialRampTo=function(t,e,i){return i=this.toSeconds(i),this.setRampPoint(i),this.exponentialRampToValueAtTime(t,i+this.toSeconds(e)),this},n.a.Param.prototype.linearRampTo=function(t,e,i){return i=this.toSeconds(i),this.setRampPoint(i),this.linearRampToValueAtTime(t,i+this.toSeconds(e)),this},n.a.Param.prototype.targetRampTo=function(t,e,i){return i=this.toSeconds(i),this.setRampPoint(i),this.exponentialApproachValueAtTime(t,i,e),this},n.a.Param.prototype.exponentialApproachValueAtTime=function(t,e,i){var n=Math.log(this.toSeconds(i)+1)/Math.log(200);return e=this.toSeconds(e),this.setTargetAtTime(t,e,n),this.cancelAndHoldAtTime(e+.9*i),this.linearRampToValueAtTime(t,e+i),this},n.a.Param.prototype.setTargetAtTime=function(t,e,i){if(t=this._fromUnits(t),i<=0)throw new Error("timeConstant must be greater than 0");return e=this.toSeconds(e),this._events.add({type:n.a.Param.AutomationType.Target,value:t,time:e,constant:i}),this.log(n.a.Param.AutomationType.Target,t,e,i),this._param.setTargetAtTime(t,e,i),this},n.a.Param.prototype.setValueCurveAtTime=function(t,e,i,o){o=n.a.defaultArg(o,1),i=this.toSeconds(i),e=this.toSeconds(e),this.setValueAtTime(t[0]*o,e);for(var s=i/(t.length-1),r=1;r<t.length;r++)this.linearRampToValueAtTime(t[r]*o,e+r*s);return this},n.a.Param.prototype.cancelScheduledValues=function(t){return t=this.toSeconds(t),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(n.a.Param.AutomationType.Cancel,t),this},n.a.Param.prototype.cancelAndHoldAtTime=function(t){t=this.toSeconds(t);var e=this.getValueAtTime(t);this.log("cancelAndHoldAtTime",t,"value="+e),this._param.cancelScheduledValues(t);var i=this._events.get(t),o=this._events.getAfter(t);return i&&i.time===t?o?this._events.cancel(o.time):this._events.cancel(t+this.sampleTime):o&&(this._events.cancel(o.time),o.type===n.a.Param.AutomationType.Linear?this.linearRampToValueAtTime(e,t):o.type===n.a.Param.AutomationType.Exponential&&this.exponentialRampToValueAtTime(e,t)),this._events.add({type:n.a.Param.AutomationType.SetValue,value:e,time:t}),this._param.setValueAtTime(e,t),this},n.a.Param.prototype.rampTo=function(t,e,i){return e=n.a.defaultArg(e,.1),this.units===n.a.Type.Frequency||this.units===n.a.Type.BPM||this.units===n.a.Type.Decibels?this.exponentialRampTo(t,e,i):this.linearRampTo(t,e,i),this},n.a.Param.prototype._exponentialApproach=function(t,e,i,n,o){return i+(e-i)*Math.exp(-(o-t)/n)},n.a.Param.prototype._linearInterpolate=function(t,e,i,n,o){return e+(o-t)/(i-t)*(n-e)},n.a.Param.prototype._exponentialInterpolate=function(t,e,i,n,o){return e*Math.pow(n/e,(o-t)/(i-t))},n.a.Param.prototype.dispose=function(){return n.a.AudioNode.prototype.dispose.call(this),this._param=null,this._events=null,this};n.a.Param;n.a.SignalBase=function(){n.a.AudioNode.call(this)},n.a.extend(n.a.SignalBase,n.a.AudioNode),n.a.SignalBase.prototype.connect=function(t,e,i){return n.a.Signal&&n.a.Signal===t.constructor||n.a.Param&&n.a.Param===t.constructor?(t._param.cancelScheduledValues(0),t._param.setValueAtTime(0,0),t.overridden=!0):t instanceof AudioParam&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0)),n.a.AudioNode.prototype.connect.call(this,t,e,i),this};n.a.SignalBase;n.a.Gain=function(){var t=n.a.defaults(arguments,["gain","units"],n.a.Gain);n.a.AudioNode.call(this,t),this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new n.a.Param({param:this._gainNode.gain,units:t.units,value:t.gain,convert:t.convert}),this._readOnly("gain")},n.a.extend(n.a.Gain,n.a.AudioNode),n.a.Gain.defaults={gain:1,convert:!0},n.a.Gain.prototype.dispose=function(){n.a.AudioNode.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null};n.a.Gain;if(n.a.supported&&!n.a.global.AudioContext.prototype.createConstantSource){var T=function(t){this.context=t;for(var e=t.createBuffer(1,128,t.sampleRate),i=e.getChannelData(0),n=0;n<i.length;n++)i[n]=1;this._bufferSource=t.createBufferSource(),this._bufferSource.channelCount=1,this._bufferSource.channelCountMode="explicit",this._bufferSource.buffer=e,this._bufferSource.loop=!0;var o=this._output=t.createGain();this.offset=o.gain,this._bufferSource.connect(o)};T.prototype.start=function(t){return this._bufferSource.start(t),this},T.prototype.stop=function(t){return this._bufferSource.stop(t),this},T.prototype.connect=function(){return this._output.connect.apply(this._output,arguments),this},T.prototype.disconnect=function(){return this._output.disconnect.apply(this._output,arguments),this},AudioContext.prototype.createConstantSource=function(){return new T(this)},n.a.Context.prototype.createConstantSource=function(){return new T(this)}}n.a.Signal=function(){var t=n.a.defaults(arguments,["value","units"],n.a.Signal);n.a.Param.call(this,t),this._constantSource=this.context.createConstantSource(),this._constantSource.start(0),this._param=this._constantSource.offset,this.value=t.value,this.output=this._constantSource,this.input=this._param=this.output.offset},n.a.extend(n.a.Signal,n.a.Param),n.a.Signal.defaults={value:0,units:n.a.Type.Default,convert:!0},n.a.Signal.prototype.connect=n.a.SignalBase.prototype.connect,n.a.Signal.prototype.disconnect=n.a.SignalBase.prototype.disconnect,n.a.Signal.prototype.getValueAtTime=function(t){return this._param.getValueAtTime?this._param.getValueAtTime(t):n.a.Param.prototype.getValueAtTime.call(this,t)},n.a.Signal.prototype.dispose=function(){return n.a.Param.prototype.dispose.call(this),this._constantSource.stop(),this._constantSource.disconnect(),this._constantSource=null,this};n.a.Signal;n.a.Volume=function(){var t=n.a.defaults(arguments,["volume"],n.a.Volume);n.a.AudioNode.call(this,t),this.output=this.input=new n.a.Gain(t.volume,n.a.Type.Decibels),this._unmutedVolume=t.volume,this.volume=this.output.gain,this._readOnly("volume"),this.mute=t.mute},n.a.extend(n.a.Volume,n.a.AudioNode),n.a.Volume.defaults={volume:0,mute:!1},Object.defineProperty(n.a.Volume.prototype,"mute",{get:function(){return this.volume.value===-1/0},set:function(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}}),n.a.Volume.prototype.dispose=function(){return this.input.dispose(),n.a.AudioNode.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this};n.a.Volume;n.a.Master=function(){n.a.AudioNode.call(this),n.a.getContext(function(){this.createInsOuts(1,0),this._volume=this.output=new n.a.Volume,this.volume=this._volume.volume,this._readOnly("volume"),n.a.connectSeries(this.input,this.output,this.context.destination),this.context.master=this}.bind(this))},n.a.extend(n.a.Master,n.a.AudioNode),n.a.Master.defaults={volume:0,mute:!1},n.a.Master.prototype.isMaster=!0,Object.defineProperty(n.a.Master.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),n.a.Master.prototype.chain=function(){this.input.disconnect();var t=Array.from(arguments);t.unshift(this.input),t.push(this.output),n.a.connectSeries.apply(void 0,t)},n.a.Master.prototype.dispose=function(){n.a.AudioNode.prototype.dispose.call(this),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null},n.a.AudioNode.prototype.toMaster=function(){return this.connect(this.context.master),this};var g=n.a.Master;n.a.Master=new g,n.a.Context.on("init",function(t){t.master&&t.master.isMaster?n.a.Master=t.master:n.a.Master=new g}),n.a.Context.on("close",function(t){t.master&&t.master.isMaster&&t.master.dispose()});n.a.Master;n.a.Instrument=function(t){t=n.a.defaultArg(t,n.a.Instrument.defaults),n.a.AudioNode.call(this),this._volume=this.output=new n.a.Volume(t.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._scheduledEvents=[]},n.a.extend(n.a.Instrument,n.a.AudioNode),n.a.Instrument.defaults={volume:0},n.a.Instrument.prototype.triggerAttack=n.a.noOp,n.a.Instrument.prototype.triggerRelease=n.a.noOp,n.a.Instrument.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this},n.a.Instrument.prototype._syncMethod=function(t,e){var i=this["_original_"+t]=this[t];this[t]=function(){var t=Array.prototype.slice.call(arguments),o=t[e],s=n.a.Transport.schedule(function(n){t[e]=n,i.apply(this,t)}.bind(this),o);this._scheduledEvents.push(s)}.bind(this)},n.a.Instrument.prototype.unsync=function(){return this._scheduledEvents.forEach(function(t){n.a.Transport.clear(t)}),this._scheduledEvents=[],this._original_triggerAttack&&(this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this},n.a.Instrument.prototype.triggerAttackRelease=function(t,e,i,n){return i=this.toSeconds(i),e=this.toSeconds(e),this.triggerAttack(t,i,n),this.triggerRelease(i+e),this},n.a.Instrument.prototype.dispose=function(){return n.a.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this.unsync(),this._scheduledEvents=null,this};n.a.Instrument;n.a.supported&&(AudioBuffer.prototype.copyToChannel||(AudioBuffer.prototype.copyToChannel=function(t,e,i){var n=this.getChannelData(e);i=i||0;for(var o=0;o<n.length;o++)n[o+i]=t[o]},AudioBuffer.prototype.copyFromChannel=function(t,e,i){var n=this.getChannelData(e);i=i||0;for(var o=0;o<t.length;o++)t[o]=n[o+i]})),n.a.Buffer=function(){var t=n.a.defaults(arguments,["url","onload","onerror"],n.a.Buffer);n.a.call(this),this._buffer=null,this._reversed=t.reverse,this._xhr=null,this.onload=n.a.noOp,t.url instanceof AudioBuffer||t.url instanceof n.a.Buffer?(this.set(t.url),this.loaded||(this.onload=t.onload)):n.a.isString(t.url)&&this.load(t.url).then(t.onload).catch(t.onerror)},n.a.extend(n.a.Buffer),n.a.Buffer.defaults={url:void 0,reverse:!1,onload:n.a.noOp,onerror:n.a.noOp},n.a.Buffer.prototype.set=function(t){return t instanceof n.a.Buffer?t.loaded?this._buffer=t.get():t.onload=function(){this.set(t),this.onload(this)}.bind(this):this._buffer=t,this._reversed&&this._reverse(),this},n.a.Buffer.prototype.get=function(){return this._buffer},n.a.Buffer.prototype.load=function(t,e,i){return new Promise(function(o,s){this._xhr=n.a.Buffer.load(t,function(t){this._xhr=null,this.set(t),o(this),this.onload(this),e&&e(this)}.bind(this),function(t){this._xhr=null,s(t),i&&i(t)}.bind(this))}.bind(this))},n.a.Buffer.prototype.dispose=function(){return n.a.prototype.dispose.call(this),this._buffer=null,this._xhr&&(n.a.Buffer._removeFromDownloadQueue(this._xhr),this._xhr.abort(),this._xhr=null),this},Object.defineProperty(n.a.Buffer.prototype,"loaded",{get:function(){return this.length>0}}),Object.defineProperty(n.a.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),Object.defineProperty(n.a.Buffer.prototype,"length",{get:function(){return this._buffer?this._buffer.length:0}}),Object.defineProperty(n.a.Buffer.prototype,"numberOfChannels",{get:function(){return this._buffer?this._buffer.numberOfChannels:0}}),n.a.Buffer.prototype.fromArray=function(t){var e=t[0].length>0,i=e?t.length:1,n=e?t[0].length:t.length,o=this.context.createBuffer(i,n,this.context.sampleRate);e||1!==i||(t=[t]);for(var s=0;s<i;s++)o.copyToChannel(t[s],s);return this._buffer=o,this},n.a.Buffer.prototype.toMono=function(t){if(n.a.isNumber(t))this.fromArray(this.toArray(t));else{for(var e=new Float32Array(this.length),i=this.numberOfChannels,o=0;o<i;o++)for(var s=this.toArray(o),r=0;r<s.length;r++)e[r]+=s[r];e=e.map(function(t){return t/i}),this.fromArray(e)}return this},n.a.Buffer.prototype.toArray=function(t){if(n.a.isNumber(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);for(var e=[],i=0;i<this.numberOfChannels;i++)e[i]=this.getChannelData(i);return e},n.a.Buffer.prototype.getChannelData=function(t){return this._buffer.getChannelData(t)},n.a.Buffer.prototype.slice=function(t,e){e=n.a.defaultArg(e,this.duration);for(var i=Math.floor(this.context.sampleRate*this.toSeconds(t)),o=Math.floor(this.context.sampleRate*this.toSeconds(e)),s=[],r=0;r<this.numberOfChannels;r++)s[r]=this.toArray(r).slice(i,o);return(new n.a.Buffer).fromArray(s)},n.a.Buffer.prototype._reverse=function(){if(this.loaded)for(var t=0;t<this.numberOfChannels;t++)Array.prototype.reverse.call(this.getChannelData(t));return this},Object.defineProperty(n.a.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(t){this._reversed!==t&&(this._reversed=t,this._reverse())}}),n.a.Emitter.mixin(n.a.Buffer),n.a.Buffer._downloadQueue=[],n.a.Buffer.baseUrl="",n.a.Buffer.fromArray=function(t){return(new n.a.Buffer).fromArray(t)},n.a.Buffer.fromUrl=function(t){var e=new n.a.Buffer;return e.load(t).then(function(){return e})},n.a.Buffer._removeFromDownloadQueue=function(t){var e=n.a.Buffer._downloadQueue.indexOf(t);-1!==e&&n.a.Buffer._downloadQueue.splice(e,1)},n.a.Buffer.load=function(t,e,i){e=n.a.defaultArg(e,n.a.noOp);var o=t.match(/\[(.+\|?)+\]$/);if(o){for(var s=o[1].split("|"),r=s[0],a=0;a<s.length;a++)if(n.a.Buffer.supportsType(s[a])){r=s[a];break}t=t.replace(o[0],r)}function u(t){if(n.a.Buffer._removeFromDownloadQueue(c),n.a.Buffer.emit("error",t),!i)throw t;i(t)}function h(){for(var t=0,e=0;e<n.a.Buffer._downloadQueue.length;e++)t+=n.a.Buffer._downloadQueue[e].progress;n.a.Buffer.emit("progress",t/n.a.Buffer._downloadQueue.length)}var c=new XMLHttpRequest;return c.open("GET",n.a.Buffer.baseUrl+t,!0),c.responseType="arraybuffer",c.progress=0,n.a.Buffer._downloadQueue.push(c),c.addEventListener("load",function(){200===c.status?n.a.context.decodeAudioData(c.response).then(function(t){c.progress=1,h(),e(t),n.a.Buffer._removeFromDownloadQueue(c),0===n.a.Buffer._downloadQueue.length&&n.a.Buffer.emit("load")}).catch(function(){n.a.Buffer._removeFromDownloadQueue(c),u("Tone.Buffer: could not decode audio data: "+t)}):u("Tone.Buffer: could not locate file: "+t)}),c.addEventListener("error",u),c.addEventListener("progress",function(t){t.lengthComputable&&(c.progress=t.loaded/t.total*.95,h())}),c.send(),c},n.a.Buffer.cancelDownloads=function(){return n.a.Buffer._downloadQueue.slice().forEach(function(t){n.a.Buffer._removeFromDownloadQueue(t),t.abort()}),n.a.Buffer},n.a.Buffer.supportsType=function(t){var e=t.split(".");return e=e[e.length-1],""!==document.createElement("audio").canPlayType("audio/"+e)},n.a.loaded=function(){var t,e;function i(){n.a.Buffer.off("load",t),n.a.Buffer.off("error",e)}return new Promise(function(i,o){t=function(){i()},e=function(){o()},n.a.Buffer.on("load",t),n.a.Buffer.on("error",e)}).then(i).catch(function(t){throw i(),new Error(t)})};n.a.Buffer;n.a.Buffers=function(t){var e=Array.prototype.slice.call(arguments);e.shift();var i=n.a.defaults(e,["onload","baseUrl"],n.a.Buffers);for(var o in n.a.call(this),this._buffers={},this.baseUrl=i.baseUrl,this._loadingCount=0,t)this._loadingCount++,this.add(o,t[o],this._bufferLoaded.bind(this,i.onload))},n.a.extend(n.a.Buffers),n.a.Buffers.defaults={onload:n.a.noOp,baseUrl:""},n.a.Buffers.prototype.has=function(t){return this._buffers.hasOwnProperty(t)},n.a.Buffers.prototype.get=function(t){if(this.has(t))return this._buffers[t];throw new Error("Tone.Buffers: no buffer named "+t)},n.a.Buffers.prototype._bufferLoaded=function(t){this._loadingCount--,0===this._loadingCount&&t&&t(this)},Object.defineProperty(n.a.Buffers.prototype,"loaded",{get:function(){var t=!0;for(var e in this._buffers){var i=this.get(e);t=t&&i.loaded}return t}}),n.a.Buffers.prototype.add=function(t,e,i){return i=n.a.defaultArg(i,n.a.noOp),e instanceof n.a.Buffer?(this._buffers[t]=e,i(this)):e instanceof AudioBuffer?(this._buffers[t]=new n.a.Buffer(e),i(this)):n.a.isString(e)&&(this._buffers[t]=new n.a.Buffer(this.baseUrl+e,i)),this},n.a.Buffers.prototype.dispose=function(){for(var t in n.a.prototype.dispose.call(this),this._buffers)this._buffers[t].dispose();return this._buffers=null,this};n.a.Buffers;function v(t){return function(e,i){i=this.toSeconds(i),t.apply(this,arguments);var n=this._events.get(i),o=this._events.previousEvent(n),s=this._getTicksUntilEvent(o,i);return n.ticks=Math.max(s,0),this}}n.a.TickSignal=function(t){t=n.a.defaultArg(t,1),n.a.Signal.call(this,{units:n.a.Type.Ticks,value:t}),this._events.memory=1/0,this.cancelScheduledValues(0),this._events.add({type:n.a.Param.AutomationType.SetValue,time:0,value:t})},n.a.extend(n.a.TickSignal,n.a.Signal),n.a.TickSignal.prototype.setValueAtTime=v(n.a.Signal.prototype.setValueAtTime),n.a.TickSignal.prototype.linearRampToValueAtTime=v(n.a.Signal.prototype.linearRampToValueAtTime),n.a.TickSignal.prototype.setTargetAtTime=function(t,e,i){e=this.toSeconds(e),this.setRampPoint(e),t=this._fromUnits(t);for(var n=this._events.get(e),o=Math.round(Math.max(1/i,1)),s=0;s<=o;s++){var r=i*s+e,a=this._exponentialApproach(n.time,n.value,t,i,r);this.linearRampToValueAtTime(this._toUnits(a),r)}return this},n.a.TickSignal.prototype.exponentialRampToValueAtTime=function(t,e){e=this.toSeconds(e),t=this._fromUnits(t);for(var i=this._events.get(e),n=Math.round(Math.max(10*(e-i.time),1)),o=(e-i.time)/n,s=0;s<=n;s++){var r=o*s+i.time,a=this._exponentialInterpolate(i.time,i.value,e,t,r);this.linearRampToValueAtTime(this._toUnits(a),r)}return this},n.a.TickSignal.prototype._getTicksUntilEvent=function(t,e){if(null===t)t={ticks:0,time:0};else if(n.a.isUndef(t.ticks)){var i=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(i,t.time)}var o=this.getValueAtTime(t.time),s=this.getValueAtTime(e);return this._events.get(e).time===e&&this._events.get(e).type===n.a.Param.AutomationType.SetValue&&(s=this.getValueAtTime(e-this.sampleTime)),.5*(e-t.time)*(o+s)+t.ticks},n.a.TickSignal.prototype.getTicksAtTime=function(t){t=this.toSeconds(t);var e=this._events.get(t);return Math.max(this._getTicksUntilEvent(e,t),0)},n.a.TickSignal.prototype.getDurationOfTicks=function(t,e){e=this.toSeconds(e);var i=this.getTicksAtTime(e);return this.getTimeOfTick(i+t)-e},n.a.TickSignal.prototype.getTimeOfTick=function(t){var e=this._events.get(t,"ticks"),i=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&i&&i.type===n.a.Param.AutomationType.Linear&&e.value!==i.value){var o=this.getValueAtTime(e.time),s=(this.getValueAtTime(i.time)-o)/(i.time-e.time),r=Math.sqrt(Math.pow(o,2)-2*s*(e.ticks-t)),a=(-o+r)/s;return(a>0?a:(-o-r)/s)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue},n.a.TickSignal.prototype.ticksToTime=function(t,e){return e=this.toSeconds(e),new n.a.Time(this.getDurationOfTicks(t,e))},n.a.TickSignal.prototype.timeToTicks=function(t,e){e=this.toSeconds(e),t=this.toSeconds(t);var i=this.getTicksAtTime(e),o=this.getTicksAtTime(e+t);return new n.a.Ticks(o-i)};n.a.TickSignal;n.a.TimelineState=function(t){n.a.Timeline.call(this),this._initial=t},n.a.extend(n.a.TimelineState,n.a.Timeline),n.a.TimelineState.prototype.getValueAtTime=function(t){var e=this.get(t);return null!==e?e.state:this._initial},n.a.TimelineState.prototype.setStateAtTime=function(t,e){return this.add({state:t,time:e}),this},n.a.TimelineState.prototype.getLastState=function(t,e){e=this.toSeconds(e);for(var i=this._search(e);i>=0;i--){var n=this._timeline[i];if(n.state===t)return n}},n.a.TimelineState.prototype.getNextState=function(t,e){e=this.toSeconds(e);var i=this._search(e);if(-1!==i)for(var n=i;n<this._timeline.length;n++){var o=this._timeline[n];if(o.state===t)return o}};n.a.TimelineState;n.a.TickSource=function(){var t=n.a.defaults(arguments,["frequency"],n.a.TickSource);this.frequency=new n.a.TickSignal(t.frequency),this._readOnly("frequency"),this._state=new n.a.TimelineState(n.a.State.Stopped),this._state.setStateAtTime(n.a.State.Stopped,0),this._tickOffset=new n.a.Timeline,this.setTicksAtTime(0,0)},n.a.extend(n.a.TickSource),n.a.TickSource.defaults={frequency:1},Object.defineProperty(n.a.TickSource.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),n.a.TickSource.prototype.start=function(t,e){return t=this.toSeconds(t),this._state.getValueAtTime(t)!==n.a.State.Started&&(this._state.setStateAtTime(n.a.State.Started,t),n.a.isDefined(e)&&this.setTicksAtTime(e,t)),this},n.a.TickSource.prototype.stop=function(t){if(t=this.toSeconds(t),this._state.getValueAtTime(t)===n.a.State.Stopped){var e=this._state.get(t);e.time>0&&(this._tickOffset.cancel(e.time),this._state.cancel(e.time))}return this._state.cancel(t),this._state.setStateAtTime(n.a.State.Stopped,t),this.setTicksAtTime(0,t),this},n.a.TickSource.prototype.pause=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)===n.a.State.Started&&this._state.setStateAtTime(n.a.State.Paused,t),this},n.a.TickSource.prototype.cancel=function(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this},n.a.TickSource.prototype.getTicksAtTime=function(t){t=this.toSeconds(t);var e=this._state.getLastState(n.a.State.Stopped,t),i={state:n.a.State.Paused,time:t};this._state.add(i);var o=e,s=0;return this._state.forEachBetween(e.time,t+this.sampleTime,function(t){var e=o.time,i=this._tickOffset.get(t.time);i.time>=o.time&&(s=i.ticks,e=i.time),o.state===n.a.State.Started&&t.state!==n.a.State.Started&&(s+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),o=t}.bind(this)),this._state.remove(i),s},Object.defineProperty(n.a.TickSource.prototype,"ticks",{get:function(){return this.getTicksAtTime(this.now())},set:function(t){this.setTicksAtTime(t,this.now())}}),Object.defineProperty(n.a.TickSource.prototype,"seconds",{get:function(){return this.getSecondsAtTime(this.now())},set:function(t){var e=this.now(),i=this.frequency.timeToTicks(t,e);this.setTicksAtTime(i,e)}}),n.a.TickSource.prototype.getSecondsAtTime=function(t){t=this.toSeconds(t);var e=this._state.getLastState(n.a.State.Stopped,t),i={state:n.a.State.Paused,time:t};this._state.add(i);var o=e,s=0;return this._state.forEachBetween(e.time,t+this.sampleTime,function(t){var e=o.time,i=this._tickOffset.get(t.time);i.time>=o.time&&(s=i.seconds,e=i.time),o.state===n.a.State.Started&&t.state!==n.a.State.Started&&(s+=t.time-e),o=t}.bind(this)),this._state.remove(i),s},n.a.TickSource.prototype.setTicksAtTime=function(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({time:e,ticks:t,seconds:this.frequency.getDurationOfTicks(t,e)}),this},n.a.TickSource.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)},n.a.TickSource.prototype.getTimeOfTick=function(t,e){e=n.a.defaultArg(e,this.now());var i=this._tickOffset.get(e),o=this._state.get(e),s=Math.max(i.time,o.time),r=this.frequency.getTicksAtTime(s)+t-i.ticks;return this.frequency.getTimeOfTick(r)},n.a.TickSource.prototype.forEachTickBetween=function(t,e,i){var o=this._state.get(t);if(this._state.forEachBetween(t,e,function(e){o.state===n.a.State.Started&&e.state!==n.a.State.Started&&this.forEachTickBetween(Math.max(o.time,t),e.time-this.sampleTime,i),o=e}.bind(this)),t=Math.max(o.time,t),o.state===n.a.State.Started&&this._state){var s=this.frequency.getTicksAtTime(t),r=(s-this.frequency.getTicksAtTime(o.time))%1;0!==r&&(r=1-r);for(var a=this.frequency.getTimeOfTick(s+r),u=null;a<e&&this._state;){try{i(a,Math.round(this.getTicksAtTime(a)))}catch(A){u=A;break}this._state&&(a+=this.frequency.getDurationOfTicks(1,a))}}if(u)throw u;return this},n.a.TickSource.prototype.dispose=function(){return n.a.Param.prototype.dispose.call(this),this._state.dispose(),this._state=null,this._tickOffset.dispose(),this._tickOffset=null,this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this};n.a.TickSource;n.a.Clock=function(){var t=n.a.defaults(arguments,["callback","frequency"],n.a.Clock);n.a.Emitter.call(this),this.callback=t.callback,this._nextTick=0,this._tickSource=new n.a.TickSource(t.frequency),this._lastUpdate=0,this.frequency=this._tickSource.frequency,this._readOnly("frequency"),this._state=new n.a.TimelineState(n.a.State.Stopped),this._state.setStateAtTime(n.a.State.Stopped,0),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},n.a.extend(n.a.Clock,n.a.Emitter),n.a.Clock.defaults={callback:n.a.noOp,frequency:1},Object.defineProperty(n.a.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),n.a.Clock.prototype.start=function(t,e){return this.context.resume(),t=this.toSeconds(t),this._state.getValueAtTime(t)!==n.a.State.Started&&(this._state.setStateAtTime(n.a.State.Started,t),this._tickSource.start(t,e),t<this._lastUpdate&&this.emit("start",t,e)),this},n.a.Clock.prototype.stop=function(t){return t=this.toSeconds(t),this._state.cancel(t),this._state.setStateAtTime(n.a.State.Stopped,t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this},n.a.Clock.prototype.pause=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)===n.a.State.Started&&(this._state.setStateAtTime(n.a.State.Paused,t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this},Object.defineProperty(n.a.Clock.prototype,"ticks",{get:function(){return Math.ceil(this.getTicksAtTime(this.now()))},set:function(t){this._tickSource.ticks=t}}),Object.defineProperty(n.a.Clock.prototype,"seconds",{get:function(){return this._tickSource.seconds},set:function(t){this._tickSource.seconds=t}}),n.a.Clock.prototype.getSecondsAtTime=function(t){return this._tickSource.getSecondsAtTime(t)},n.a.Clock.prototype.setTicksAtTime=function(t,e){return this._tickSource.setTicksAtTime(t,e),this},n.a.Clock.prototype.getTicksAtTime=function(t){return this._tickSource.getTicksAtTime(t)},n.a.Clock.prototype.nextTickTime=function(t,e){e=this.toSeconds(e);var i=this.getTicksAtTime(e);return this._tickSource.getTimeOfTick(i+t,e)},n.a.Clock.prototype._loop=function(){var t=this._lastUpdate,e=this.now();this._lastUpdate=e,t!==e&&(this._state.forEachBetween(t,e,function(t){switch(t.state){case n.a.State.Started:var e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case n.a.State.Stopped:0!==t.time&&this.emit("stop",t.time);break;case n.a.State.Paused:this.emit("pause",t.time)}}.bind(this)),this._tickSource.forEachTickBetween(t,e,function(t,e){this.callback(t,e)}.bind(this)))},n.a.Clock.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)},n.a.Clock.prototype.dispose=function(){n.a.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this._tickSource.dispose(),this._tickSource=null,this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null};n.a.Clock;n.a.IntervalTimeline=function(){n.a.call(this),this._root=null,this._length=0},n.a.extend(n.a.IntervalTimeline),n.a.IntervalTimeline.prototype.add=function(t){if(n.a.isUndef(t.time)||n.a.isUndef(t.duration))throw new Error("Tone.IntervalTimeline: events must have time and duration parameters");t.time=t.time.valueOf();var e=new S(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this},n.a.IntervalTimeline.prototype.remove=function(t){if(null!==this._root){var e=[];this._root.search(t.time,e);for(var i=0;i<e.length;i++){var n=e[i];if(n.event===t){this._removeNode(n),this._length--;break}}}return this},Object.defineProperty(n.a.IntervalTimeline.prototype,"length",{get:function(){return this._length}}),n.a.IntervalTimeline.prototype.cancel=function(t){return this.forEachFrom(t,function(t){this.remove(t)}.bind(this)),this},n.a.IntervalTimeline.prototype._setRoot=function(t){this._root=t,null!==this._root&&(this._root.parent=null)},n.a.IntervalTimeline.prototype._replaceNodeInParent=function(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)},n.a.IntervalTimeline.prototype._removeNode=function(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{var e,i;if(t.getBalance()>0)if(null===t.left.right)(e=t.left).right=t.right,i=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent.right=e.left,i=e.parent,e.left=t.left,e.right=t.right}else if(null===t.right.left)(e=t.right).left=t.left,i=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent.left=e.right,i=e.parent,e.left=t.left,e.right=t.right}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),this._rebalance(i)}t.dispose()},n.a.IntervalTimeline.prototype._rotateLeft=function(t){var e=t.parent,i=t.isLeftChild(),n=t.right;t.right=n.left,n.left=t,null!==e?i?e.left=n:e.right=n:this._setRoot(n)},n.a.IntervalTimeline.prototype._rotateRight=function(t){var e=t.parent,i=t.isLeftChild(),n=t.left;t.left=n.right,n.right=t,null!==e?i?e.left=n:e.right=n:this._setRoot(n)},n.a.IntervalTimeline.prototype._rebalance=function(t){var e=t.getBalance();e>1?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))},n.a.IntervalTimeline.prototype.get=function(t){if(null!==this._root){var e=[];if(this._root.search(t,e),e.length>0){for(var i=e[0],n=1;n<e.length;n++)e[n].low>i.low&&(i=e[n]);return i.event}}return null},n.a.IntervalTimeline.prototype.forEach=function(t){if(null!==this._root){var e=[];this._root.traverse(function(t){e.push(t)});for(var i=0;i<e.length;i++){var n=e[i].event;n&&t(n)}}return this},n.a.IntervalTimeline.prototype.forEachAtTime=function(t,e){if(null!==this._root){var i=[];this._root.search(t,i);for(var n=i.length-1;n>=0;n--){var o=i[n].event;o&&e(o)}}return this},n.a.IntervalTimeline.prototype.forEachFrom=function(t,e){if(null!==this._root){var i=[];this._root.searchAfter(t,i);for(var n=i.length-1;n>=0;n--){e(i[n].event)}}return this},n.a.IntervalTimeline.prototype.dispose=function(){var t=[];null!==this._root&&this._root.traverse(function(e){t.push(e)});for(var e=0;e<t.length;e++)t[e].dispose();return t=null,this._root=null,this};var S=function(t,e,i){this.event=i,this.low=t,this.high=e,this.max=this.high,this._left=null,this._right=null,this.parent=null,this.height=0};S.prototype.insert=function(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)},S.prototype.search=function(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))},S.prototype.searchAfter=function(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)},S.prototype.traverse=function(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)},S.prototype.updateHeight=function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0},S.prototype.updateMax=function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))},S.prototype.getBalance=function(){var t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t},S.prototype.isLeftChild=function(){return null!==this.parent&&this.parent.left===this},Object.defineProperty(S.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}}),Object.defineProperty(S.prototype,"right",{get:function(){return this._right},set:function(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}}),S.prototype.dispose=function(){this.parent=null,this._left=null,this._right=null,this.event=null};n.a.IntervalTimeline;n.a.Ticks=function(t,e){if(!(this instanceof n.a.Ticks))return new n.a.Ticks(t,e);n.a.TransportTime.call(this,t,e)},n.a.extend(n.a.Ticks,n.a.TransportTime),n.a.Ticks.prototype._defaultUnits="i",n.a.Ticks.prototype._now=function(){return n.a.Transport.ticks},n.a.Ticks.prototype._beatsToUnits=function(t){return this._getPPQ()*t},n.a.Ticks.prototype._secondsToUnits=function(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())},n.a.Ticks.prototype._ticksToUnits=function(t){return t},n.a.Ticks.prototype.toTicks=function(){return this.valueOf()},n.a.Ticks.prototype.toSeconds=function(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())};n.a.Ticks;n.a.TransportEvent=function(t,e){e=n.a.defaultArg(e,n.a.TransportEvent.defaults),n.a.call(this),this.Transport=t,this.id=n.a.TransportEvent._eventId++,this.time=n.a.Ticks(e.time),this.callback=e.callback,this._once=e.once},n.a.extend(n.a.TransportEvent),n.a.TransportEvent.defaults={once:!1,callback:n.a.noOp},n.a.TransportEvent._eventId=0,n.a.TransportEvent.prototype.invoke=function(t){this.callback&&(this.callback(t),this._once&&this.Transport&&this.Transport.clear(this.id))},n.a.TransportEvent.prototype.dispose=function(){return n.a.prototype.dispose.call(this),this.Transport=null,this.callback=null,this.time=null,this};n.a.TransportEvent;n.a.TransportRepeatEvent=function(t,e){n.a.TransportEvent.call(this,t,e),e=n.a.defaultArg(e,n.a.TransportRepeatEvent.defaults),this.duration=n.a.Ticks(e.duration),this._interval=n.a.Ticks(e.interval),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this),this.Transport.on("start loopStart",this._boundRestart),this._restart()},n.a.extend(n.a.TransportRepeatEvent,n.a.TransportEvent),n.a.TransportRepeatEvent.defaults={duration:1/0,interval:1},n.a.TransportRepeatEvent.prototype.invoke=function(t){this._createEvents(t),n.a.TransportEvent.prototype.invoke.call(this,t)},n.a.TransportRepeatEvent.prototype._createEvents=function(t){var e=this.Transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),n.a.Ticks(this._nextTick)))},n.a.TransportRepeatEvent.prototype._restart=function(t){this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this._nextTick=this.time;var e=this.Transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.Transport.scheduleOnce(this.invoke.bind(this),n.a.Ticks(this._nextTick)),this._nextTick+=this._interval,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),n.a.Ticks(this._nextTick))},n.a.TransportRepeatEvent.prototype.dispose=function(){return this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this.Transport.off("start loopStart",this._boundRestart),this._boundCreateEvents=null,n.a.TransportEvent.prototype.dispose.call(this),this.duration=null,this._interval=null,this};n.a.TransportRepeatEvent;n.a.Transport=function(){n.a.Emitter.call(this),n.a.getContext(function(){this.loop=!1,this._loopStart=0,this._loopEnd=0,this._ppq=b.defaults.PPQ,this._clock=new n.a.Clock({callback:this._processTick.bind(this),frequency:0}),this._bindClockEvents(),this.bpm=this._clock.frequency,this.bpm._toUnits=this._toUnits.bind(this),this.bpm._fromUnits=this._fromUnits.bind(this),this.bpm.units=n.a.Type.BPM,this.bpm.value=b.defaults.bpm,this._readOnly("bpm"),this._timeSignature=b.defaults.timeSignature,this._scheduledEvents={},this._timeline=new n.a.Timeline,this._repeatedEvents=new n.a.IntervalTimeline,this._syncedSignals=[],this._swingTicks=b.defaults.PPQ/2,this._swingAmount=0,this.context.transport=this}.bind(this))},n.a.extend(n.a.Transport,n.a.Emitter),n.a.Transport.defaults={bpm:120,swing:0,swingSubdivision:"8n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:192},n.a.Transport.prototype.isTransport=!0,n.a.Transport.prototype._processTick=function(t,e){if(this._swingAmount>0&&e%this._ppq!==0&&e%(2*this._swingTicks)!==0){var i=e%(2*this._swingTicks)/(2*this._swingTicks),o=Math.sin(i*Math.PI)*this._swingAmount;t+=n.a.Ticks(2*this._swingTicks/3).toSeconds()*o}this.loop&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._timeline.forEachAtTime(e,function(e){e.invoke(t)})},n.a.Transport.prototype.schedule=function(t,e){var i=new n.a.TransportEvent(this,{time:n.a.TransportTime(e),callback:t});return this._addEvent(i,this._timeline)},n.a.Transport.prototype.scheduleRepeat=function(t,e,i,o){var s=new n.a.TransportRepeatEvent(this,{callback:t,interval:n.a.Time(e),time:n.a.TransportTime(i),duration:n.a.Time(n.a.defaultArg(o,1/0))});return this._addEvent(s,this._repeatedEvents)},n.a.Transport.prototype.scheduleOnce=function(t,e){var i=new n.a.TransportEvent(this,{time:n.a.TransportTime(e),callback:t,once:!0});return this._addEvent(i,this._timeline)},n.a.Transport.prototype.clear=function(t){if(this._scheduledEvents.hasOwnProperty(t)){var e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this},n.a.Transport.prototype._addEvent=function(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id},n.a.Transport.prototype.cancel=function(t){return t=n.a.defaultArg(t,0),t=this.toTicks(t),this._timeline.forEachFrom(t,function(t){this.clear(t.id)}.bind(this)),this._repeatedEvents.forEachFrom(t,function(t){this.clear(t.id)}.bind(this)),this},n.a.Transport.prototype._bindClockEvents=function(){this._clock.on("start",function(t,e){e=n.a.Ticks(e).toSeconds(),this.emit("start",t,e)}.bind(this)),this._clock.on("stop",function(t){this.emit("stop",t)}.bind(this)),this._clock.on("pause",function(t){this.emit("pause",t)}.bind(this))},Object.defineProperty(n.a.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}}),n.a.Transport.prototype.start=function(t,e){return n.a.isDefined(e)&&(e=this.toTicks(e)),this._clock.start(t,e),this},n.a.Transport.prototype.stop=function(t){return this._clock.stop(t),this},n.a.Transport.prototype.pause=function(t){return this._clock.pause(t),this},n.a.Transport.prototype.toggle=function(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!==n.a.State.Started?this.start(t):this.stop(t),this},Object.defineProperty(n.a.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(t){n.a.isArray(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}}),Object.defineProperty(n.a.Transport.prototype,"loopStart",{get:function(){return n.a.Ticks(this._loopStart).toSeconds()},set:function(t){this._loopStart=this.toTicks(t)}}),Object.defineProperty(n.a.Transport.prototype,"loopEnd",{get:function(){return n.a.Ticks(this._loopEnd).toSeconds()},set:function(t){this._loopEnd=this.toTicks(t)}}),n.a.Transport.prototype.setLoopPoints=function(t,e){return this.loopStart=t,this.loopEnd=e,this},Object.defineProperty(n.a.Transport.prototype,"swing",{get:function(){return this._swingAmount},set:function(t){this._swingAmount=t}}),Object.defineProperty(n.a.Transport.prototype,"swingSubdivision",{get:function(){return n.a.Ticks(this._swingTicks).toNotation()},set:function(t){this._swingTicks=this.toTicks(t)}}),Object.defineProperty(n.a.Transport.prototype,"position",{get:function(){var t=this.now(),e=this._clock.getTicksAtTime(t);return n.a.Ticks(e).toBarsBeatsSixteenths()},set:function(t){var e=this.toTicks(t);this.ticks=e}}),Object.defineProperty(n.a.Transport.prototype,"seconds",{get:function(){return this._clock.seconds},set:function(t){var e=this.now(),i=this.bpm.timeToTicks(t,e);this.ticks=i}}),Object.defineProperty(n.a.Transport.prototype,"progress",{get:function(){if(this.loop){var t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}}),Object.defineProperty(n.a.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(t){if(this._clock.ticks!==t){var e=this.now();this.state===n.a.State.Started?(this.emit("stop",e),this._clock.setTicksAtTime(t,e),this.emit("start",e,this.seconds)):this._clock.setTicksAtTime(t,e)}}}),n.a.Transport.prototype.getTicksAtTime=function(t){return Math.round(this._clock.getTicksAtTime(t))},n.a.Transport.prototype.getSecondsAtTime=function(t){return this._clock.getSecondsAtTime(t)},Object.defineProperty(n.a.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(t){var e=this.bpm.value;this._ppq=t,this.bpm.value=e}}),n.a.Transport.prototype._fromUnits=function(t){return 1/(60/t/this.PPQ)},n.a.Transport.prototype._toUnits=function(t){return t/this.PPQ*60},n.a.Transport.prototype.nextSubdivision=function(t){if(t=this.toTicks(t),this.state!==n.a.State.Started)return 0;var e=this.now(),i=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(i,e)},n.a.Transport.prototype.syncSignal=function(t,e){if(!e){var i=this.now();e=0!==t.getValueAtTime(i)?t.getValueAtTime(i)/this.bpm.getValueAtTime(i):0}var o=new n.a.Gain(e);return this.bpm.chain(o,t._param),this._syncedSignals.push({ratio:o,signal:t,initial:t.value}),t.value=0,this},n.a.Transport.prototype.unsyncSignal=function(t){for(var e=this._syncedSignals.length-1;e>=0;e--){var i=this._syncedSignals[e];i.signal===t&&(i.ratio.dispose(),i.signal.value=i.initial,this._syncedSignals.splice(e,1))}return this},n.a.Transport.prototype.dispose=function(){return n.a.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._repeatedEvents.dispose(),this._repeatedEvents=null,this};var b=n.a.Transport;n.a.Transport=new b,n.a.Context.on("init",function(t){t.transport&&t.transport.isTransport?n.a.Transport=t.transport:n.a.Transport=new b}),n.a.Context.on("close",function(t){t.transport&&t.transport.isTransport&&t.transport.dispose()});n.a.Transport;n.a.Source=function(t){t=n.a.defaultArg(t,n.a.Source.defaults),n.a.AudioNode.call(this),this._volume=this.output=new n.a.Volume(t.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._state=new n.a.TimelineState(n.a.State.Stopped),this._state.memory=100,this._synced=!1,this._scheduled=[],this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=t.mute},n.a.extend(n.a.Source,n.a.AudioNode),n.a.Source.defaults={volume:0,mute:!1},Object.defineProperty(n.a.Source.prototype,"state",{get:function(){return this._synced?n.a.Transport.state===n.a.State.Started?this._state.getValueAtTime(n.a.Transport.seconds):n.a.State.Stopped:this._state.getValueAtTime(this.now())}}),Object.defineProperty(n.a.Source.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),n.a.Source.prototype._start=n.a.noOp,n.a.Source.prototype.restart=n.a.noOp,n.a.Source.prototype._stop=n.a.noOp,n.a.Source.prototype.start=function(t,e,i){if(n.a.isUndef(t)&&this._synced?t=n.a.Transport.seconds:(t=this.toSeconds(t),t=Math.max(t,this.context.currentTime)),this._state.getValueAtTime(t)===n.a.State.Started)this._state.cancel(t),this._state.setStateAtTime(n.a.State.Started,t),this.restart(t,e,i);else if(this._state.setStateAtTime(n.a.State.Started,t),this._synced){var o=this._state.get(t);o.offset=n.a.defaultArg(e,0),o.duration=i;var s=n.a.Transport.schedule(function(t){this._start(t,e,i)}.bind(this),t);this._scheduled.push(s),n.a.Transport.state===n.a.State.Started&&this._syncedStart(this.now(),n.a.Transport.seconds)}else this._start.apply(this,arguments);return this},n.a.Source.prototype.stop=function(t){if(n.a.isUndef(t)&&this._synced?t=n.a.Transport.seconds:(t=this.toSeconds(t),t=Math.max(t,this.context.currentTime)),this._synced){var e=n.a.Transport.schedule(this._stop.bind(this),t);this._scheduled.push(e)}else this._stop.apply(this,arguments);return this._state.cancel(t),this._state.setStateAtTime(n.a.State.Stopped,t),this},n.a.Source.prototype.sync=function(){return this._synced=!0,this._syncedStart=function(t,e){if(e>0){var i=this._state.get(e);if(i&&i.state===n.a.State.Started&&i.time!==e){var o,s=e-this.toSeconds(i.time);i.duration&&(o=this.toSeconds(i.duration)-s),this._start(t,this.toSeconds(i.offset)+s,o)}}}.bind(this),this._syncedStop=function(t){var e=n.a.Transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(e)===n.a.State.Started&&this._stop(t)}.bind(this),n.a.Transport.on("start loopStart",this._syncedStart),n.a.Transport.on("stop pause loopEnd",this._syncedStop),this},n.a.Source.prototype.unsync=function(){this._synced&&(n.a.Transport.off("stop pause loopEnd",this._syncedStop),n.a.Transport.off("start loopStart",this._syncedStart)),this._synced=!1;for(var t=0;t<this._scheduled.length;t++){var e=this._scheduled[t];n.a.Transport.clear(e)}return this._scheduled=[],this._state.cancel(0),this},n.a.Source.prototype.dispose=function(){n.a.AudioNode.prototype.dispose.call(this),this.unsync(),this._scheduled=null,this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this._state.dispose(),this._state=null};n.a.Source;n.a.BufferSource=function(){var t=n.a.defaults(arguments,["buffer","onload"],n.a.BufferSource);n.a.AudioNode.call(this,t),this.onended=t.onended,this._startTime=-1,this._sourceStarted=!1,this._sourceStopped=!1,this._stopTime=-1,this._gainNode=this.output=new n.a.Gain(0),this._source=this.context.createBufferSource(),n.a.connect(this._source,this._gainNode),this._source.onended=this._onended.bind(this),this._buffer=new n.a.Buffer(t.buffer,t.onload),this.playbackRate=new n.a.Param({param:this._source.playbackRate,units:n.a.Type.Positive,value:t.playbackRate}),this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut,this.curve=t.curve,this._onendedTimeout=-1,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd},n.a.extend(n.a.BufferSource,n.a.AudioNode),n.a.BufferSource.defaults={onended:n.a.noOp,onload:n.a.noOp,loop:!1,loopStart:0,loopEnd:0,fadeIn:0,fadeOut:0,curve:"linear",playbackRate:1},Object.defineProperty(n.a.BufferSource.prototype,"state",{get:function(){return this.getStateAtTime(this.now())}}),n.a.BufferSource.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),-1!==this._startTime&&this._startTime<=t&&(-1===this._stopTime||t<this._stopTime)&&!this._sourceStopped?n.a.State.Started:n.a.State.Stopped},n.a.BufferSource.prototype.start=function(t,e,i,o){this.log("start",t,e,i,o),this.assert(-1===this._startTime,"can only be started once"),this.assert(this.buffer.loaded,"buffer is either not set or not loaded"),this.assert(!this._sourceStopped,"source is already stopped"),t=this.toSeconds(t),e=this.loop?n.a.defaultArg(e,this.loopStart):n.a.defaultArg(e,0),e=this.toSeconds(e),e=Math.max(e,0),o=n.a.defaultArg(o,1);var s=this.toSeconds(this.fadeIn);if(s>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(o,t+s):this._gainNode.gain.exponentialApproachValueAtTime(o,t,s)):this._gainNode.gain.setValueAtTime(o,t),this._startTime=t,n.a.isDefined(i)){var r=this.toSeconds(i);r=Math.max(r,0),this.stop(t+r)}if(this.loop){var a=this.loopEnd||this.buffer.duration,u=this.loopStart;e>=a&&(e=(e-u)%(a-u)+u)}return this._source.buffer=this.buffer.get(),this._source.loopEnd=this.loopEnd||this.buffer.duration,e<this.buffer.duration&&(this._sourceStarted=!0,this._source.start(t,e)),this},n.a.BufferSource.prototype.stop=function(t){this.log("stop",t),this.assert(this.buffer.loaded,"buffer is either not set or not loaded"),this.assert(!this._sourceStopped,"source is already stopped"),t=this.toSeconds(t),-1!==this._stopTime&&this.cancelStop();var e=this.toSeconds(this.fadeOut);return this._stopTime=t+e,e>0?"linear"===this.curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),n.a.context.clearTimeout(this._onendedTimeout),this._onendedTimeout=n.a.context.setTimeout(this._onended.bind(this),this._stopTime-this.now()),this},n.a.BufferSource.prototype.cancelStop=function(){if(-1!==this._startTime&&!this._sourceStopped){var t=this.toSeconds(this.fadeIn);this._gainNode.gain.cancelScheduledValues(this._startTime+t+this.sampleTime),this.context.clearTimeout(this._onendedTimeout),this._stopTime=-1}return this},n.a.BufferSource.prototype._onended=function(){if(!this._sourceStopped){this._sourceStopped=!0;var t="exponential"===this.curve?2*this.fadeOut:0;this._sourceStarted&&-1!==this._stopTime&&this._source.stop(this._stopTime+t),this.onended(this),setTimeout(function(){this._source&&(this._source.disconnect(),this._gainNode.disconnect())}.bind(this),1e3*t+100)}},Object.defineProperty(n.a.BufferSource.prototype,"loopStart",{get:function(){return this._source.loopStart},set:function(t){this._source.loopStart=this.toSeconds(t)}}),Object.defineProperty(n.a.BufferSource.prototype,"loopEnd",{get:function(){return this._source.loopEnd},set:function(t){this._source.loopEnd=this.toSeconds(t)}}),Object.defineProperty(n.a.BufferSource.prototype,"buffer",{get:function(){return this._buffer},set:function(t){this._buffer.set(t)}}),Object.defineProperty(n.a.BufferSource.prototype,"loop",{get:function(){return this._source.loop},set:function(t){this._source.loop=t,this.cancelStop()}}),n.a.BufferSource.prototype.dispose=function(){return this._wasDisposed||(this._wasDisposed=!0,n.a.AudioNode.prototype.dispose.call(this),this.onended=null,this._source.onended=null,this._source.disconnect(),this._source=null,this._gainNode.dispose(),this._gainNode=null,this._buffer.dispose(),this._buffer=null,this._startTime=-1,this.playbackRate=null,n.a.context.clearTimeout(this._onendedTimeout)),this};n.a.BufferSource;n.a.Sampler=function(t){var e=Array.prototype.slice.call(arguments);e.shift();var i=n.a.defaults(e,["onload","baseUrl"],n.a.Sampler);n.a.Instrument.call(this,i);var o={};for(var s in t)if(n.a.isNote(s)){o[n.a.Frequency(s).toMidi()]=t[s]}else{if(isNaN(parseFloat(s)))throw new Error("Tone.Sampler: url keys must be the note's pitch");o[s]=t[s]}this._buffers=new n.a.Buffers(o,i.onload,i.baseUrl),this._activeSources={},this.attack=i.attack,this.release=i.release,this.curve=i.curve},n.a.extend(n.a.Sampler,n.a.Instrument),n.a.Sampler.defaults={attack:0,release:.1,onload:n.a.noOp,baseUrl:"",curve:"exponential"},n.a.Sampler.prototype._findClosest=function(t){for(var e=0;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error("No available buffers for note: "+t)},n.a.Sampler.prototype.triggerAttack=function(t,e,i){this.log("triggerAttack",t,e,i),Array.isArray(t)||(t=[t]);for(var o=0;o<t.length;o++){var s=n.a.Frequency(t[o]).toMidi(),r=this._findClosest(s),a=s-r,u=this._buffers.get(a),h=n.a.intervalToFrequencyRatio(r),c=new n.a.BufferSource({buffer:u,playbackRate:h,fadeIn:this.attack,fadeOut:this.release,curve:this.curve}).connect(this.output);c.start(e,0,u.duration/h,i),n.a.isArray(this._activeSources[s])||(this._activeSources[s]=[]),this._activeSources[s].push(c),c.onended=function(){if(this._activeSources&&this._activeSources[s]){var t=this._activeSources[s].indexOf(c);-1!==t&&this._activeSources[s].splice(t,1)}}.bind(this)}return this},n.a.Sampler.prototype.triggerRelease=function(t,e){this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var o=n.a.Frequency(t[i]).toMidi();this._activeSources[o]&&this._activeSources[o].length&&(e=this.toSeconds(e),this._activeSources[o].forEach(function(t){t.stop(e)}),this._activeSources[o]=[])}return this},n.a.Sampler.prototype.releaseAll=function(t){for(var e in t=this.toSeconds(t),this._activeSources)for(var i=this._activeSources[e];i.length;){i.shift().stop(t)}return this},n.a.Sampler.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this},n.a.Sampler.prototype.triggerAttackRelease=function(t,e,i,o){if(i=this.toSeconds(i),this.triggerAttack(t,i,o),n.a.isArray(e)&&n.a.isArray(t))for(var s=0;s<t.length;s++){var r=e[Math.min(s,e.length-1)];this.triggerRelease(t[s],i+this.toSeconds(r))}else this.triggerRelease(t,i+this.toSeconds(e));return this},n.a.Sampler.prototype.add=function(t,e,i){if(n.a.isNote(t)){var o=n.a.Frequency(t).toMidi();this._buffers.add(o,e,i)}else{if(isNaN(parseFloat(t)))throw new Error("Tone.Sampler: note must be the note's pitch. Instead got "+t);this._buffers.add(t,e,i)}},Object.defineProperty(n.a.Sampler.prototype,"loaded",{get:function(){return this._buffers.loaded}}),n.a.Sampler.prototype.dispose=function(){for(var t in n.a.Instrument.prototype.dispose.call(this),this._buffers.dispose(),this._buffers=null,this._activeSources)this._activeSources[t].forEach(function(t){t.dispose()});return this._activeSources=null,this};e.a=n.a.Sampler}}]);
//# sourceMappingURL=4.b7d9966f.chunk.js.map