(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{27:function(e,t,n){e.exports=n(45)},32:function(e,t,n){},34:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},35:function(e,t,n){},45:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(23),i=n.n(o),c=(n(32),n(15)),u=n.n(c),l=n(18),s=n(1),m=n(3),d=(n(34),n(35),n(24)),f=n(2),h=n(8),v=n(9),p=n(14);function g(e,t){var n=document.createElement("a");document.body.appendChild(n),n.style="display: none";var a=URL.createObjectURL(e);n.href=a,n.download=t,n.click(),URL.revokeObjectURL(a),n.remove()}function b(e,t){var n=[],a=e.createMediaStreamDestination(),r=new MediaRecorder(a.stream);return t.connect(a),r.ondataavailable=function(e){n.push(e.data)},r.onstop=function(e){g(new Blob(n,{type:"audio/ogg; codecs=opus"}),"audio.ogg")},r}function y(e){var t=r.a.useRef(b(e.actx,e.inputNode)),n=r.a.useState(!1),a=Object(s.a)(n,2),o=a[0],i=a[1],c=r.a.useCallback(function(){return i(function(e){return!e})},[i]);return r.a.useEffect(function(){o?t.current.start():"inactive"!==t.current.state&&(t.current.stop(),t.current=b(e.actx,e.inputNode))},[o]),r.a.createElement("button",{onClick:c},o?"stop recording":"record audio")}var E=r.a.memo(function(e){return"undefined"==typeof MediaRecorder?r.a.createElement("button",{disabled:!0},"[recording not available]"):r.a.createElement(y,e)}),k={boolean:{parse:function(e){return!(null==e||"false"===e)},stringify:function(e){return JSON.stringify(e)}},integer:{parse:function(e){return parseInt(e,10)},stringify:function(e){return JSON.stringify(e)}},string:{parse:function(e){return e},stringify:function(e){return e}}};function w(e,t,n){var r=Object(a.useState)(function(){try{var a=new URL(window.location.href).searchParams.get(e);return null!=a?n.parse(a):t}catch(r){return console.log(r),t}}),o=Object(s.a)(r,2),i=o[0],c=o[1];return[i,function(t){try{var a="function"===typeof t?t(i):t;c(a);var r=new URL(window.location.href);r.searchParams.set(e,n.stringify(a)),window.history.replaceState(null,null,r.toString())}catch(o){console.log(o)}}]}function j(e){var t=e.onChangeOutput,n=e.selectedOutput,a=r.a.useState([]),o=Object(s.a)(a,2),i=o[0],c=o[1];return r.a.useEffect(function(){navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then(function(e){c(Array.from(e.outputs.values())),e.onstatechange=function(t){c(Array.from(e.outputs.values()))}})},[]),r.a.createElement("label",null,"midi out:"," ",r.a.createElement("select",{onChange:function(e){t(i[parseInt(e.currentTarget.value)])},value:i.indexOf(n)},r.a.createElement("option",{key:-1,value:-1},"(none)"),i.map(function(e,t){return r.a.createElement("option",{key:t,value:t},e.name)})))}var O=n(26);var x=["C","D","E","F","G","A","B"],C=new Set(["C","D","F","G","A"]),M={container:{textAlign:"center"},keyboard:{display:"inline-block",position:"relative",height:70,marginTop:16,marginBottom:20,cursor:"pointer"},whiteKey:{position:"absolute",borderBottomLeftRadius:4,borderBottomRightRadius:4,width:20,height:70,background:"white",border:"solid 1px black",zIndex:0},noteLabel:{width:20,marginTop:70},highlighted:{background:"orange"},blackKey:{position:"absolute",borderBottomLeftRadius:3,borderBottomRightRadius:3,width:9,height:50,background:"black",border:"solid 1px black",zIndex:1}},N={scale:"#4287f5",chord:"orange"};var S=r.a.memo(function(e){var t=x.length*e.octaves,n=[],a=e.highlightKeys,o=e.highlightType,i=e.notePlayer,c=r.a.useMemo(function(){return a?a.map(function(e){return"b"===f.b(e).acc?p.a(e):e}):null},[a]);function u(e){return{onMouseOver:function(t){t.buttons>0&&i.triggerAttack(e)},onMouseDown:function(){return i.triggerAttack(e)},onMouseUp:function(){return i.triggerRelease(e)},onMouseOut:function(){return i.triggerRelease(e)}}}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(O.a)(Array(e).keys()).map(function(e){return e+t})}(e.octaves,e.startOctave).forEach(function(e,t){x.forEach(function(a,i){var l=a+e,s=a+"#"+e;n.push(r.a.createElement("div",Object.assign({key:l},u(l),{style:Object(m.a)({},M.whiteKey,c&&c.includes(l)?{background:N[o]}:null,{left:(t*x.length+i)*(M.whiteKey.width-1)})}),r.a.createElement("div",{style:M.noteLabel},l))),C.has(a)&&n.push(r.a.createElement("div",Object.assign({key:s},u(s),{style:Object(m.a)({},M.blackKey,c&&c.includes(s)?{background:N[o]}:null,{left:(t*x.length+i+1)*(M.whiteKey.width-1)-(M.blackKey.width-1)/2})})))})}),r.a.createElement("div",{style:M.container},r.a.createElement("div",{style:Object(m.a)({},M.keyboard,{width:t*M.whiteKey.width})},n))}),A=n(25),R=function(e){var t=e.history,n=e.beatDurationSeconds,a=e.bpm,o=e.strumming,i=r.a.useCallback(function(){var e=new A.Midi;e.header.setTempo(a);var r=e.addTrack();t.forEach(function(e,t){var a=e.chordNotesForOctave,i=t*n*2,c=o/1e3;a.forEach(function(e,t){var a=t*c;r.addNote({midi:f.b(e).midi,time:i+a,duration:n+a})})}),g(new Blob([e.toArray()],{type:"audio/midi"}),"export.mid")},[t]);return r.a.createElement("button",{onClick:i},"export midi")},T=!0,D=!0,L=Boolean(new URL(document.location).searchParams.get("sampled")),B=[0,10,30,50,75,100,150,200],I={};B.forEach(function(e,t){I[e]=t});var K=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"],P={major:["major","minor","minor","major","major","minor","diminished"],minor:["minor","diminished","major","minor","minor","major","major"],dorian:["minor","minor","major","major","minor","diminished","major"],lydian:["major","major","minor","diminished","major","minor","minor"],phrygian:["minor","major","major","minor","diminished","major","minor"],ionian:["major","minor","minor","major","major","minor","diminished"],mixolydian:["major","minor","diminished","major","minor","minor","major"],locrian:["diminished","major","minor","minor","major","major","minor"]},U=Object.keys(P),F=["i","ii","iii","iv","v","vi","vii"],z=Object.keys(P).reduce(function(e,t){var n=P[t];return e[t]=n.map(function(e,t){var n=F[t];switch(e){case"major":return n.toUpperCase();case"minor":return n;case"diminished":return n+"\xb0";default:throw new Error("unknown scaleType '".concat(e,"'"))}}),e},{});function J(e,t){return h.a(e+" "+t).notes.map(function(e,n){return a=h.b(P[t][n]),r=e,a.map(function(e){return v.a("".concat(r).concat(e))}).sort(function(e,t){return e.intervals.length-t.intervals.length}).map(function(e){return"".concat(e.tonic).concat(e.aliases[0])});var a,r})}var q=140,G=1/q*60,X=144,W=128,$=80;function H(e,t,n,a){var r=f.b(t).midi,o=e;return e.forEach(function(e){e.message[1]==r&&(e.time=n-.01,e.message[0]=W)}),function(e,t){var n=e.concat(t);return n.sort(function(e,t){return e.time-t.time}),n}(o,[{message:[X,r,$],time:n},{message:[W,r,$],time:a}])}function Q(e,t){var n=v.a(e),a=t[n.tonic];return n.intervals.map(function(e){return p.b(f.d(a,e))})}function V(e,t,n){var a=h.a("".concat(e," ").concat(t)),r=a.notes,o=function(e,t){return e.intervals.map(function(n){return f.d("".concat(e.tonic).concat(t),n)})}(a,n),i={};o.forEach(function(e){i[f.b(e).pc]=e});var c=new Map(J(e,t).map(function(e,n){return[n,e.map(function(e){var a=v.a(e);return{pos:n,chord:a,chordType:P[t][n],chordNotesForOctave:Q(e,i),chordName:e,size:a.intervals.length*("Unknown"===a.quality?-1:1)}})]})),u=new Map(Array.from(c.values).map(function(e){return[e.chordName,e]})),l=new Set;return c.forEach(function(e,t){e.forEach(function(e){l.add(e.size)})}),{scaleType:t,key:e,scalePitchClasses:r,scalePosChords:c,scaleNotes:o,chordDatasByName:u,sizes:Array.from(l).sort(function(e,t){return e-t})}}var Y={major:"rgb(127,199,175)",minor:"rgb(255,158,157)",diminished:"rgb(218,216,167)"},Z={display:"block",width:"100%",cursor:"pointer",color:"black",padding:4,paddingBottom:8,height:46,overflow:"hidden",textAlign:"center"},_={display:"flex"},ee={flex:1},te=r.a.memo(function(e){var t=e.chordData,n=e.playChord,a=e.setLastChord,o=e.octave,i=e.strumming,c=e.strumMode,u=e.selected,l=e.onMouseOver;return r.a.createElement("div",{style:Object(m.a)({},Z,{background:Y[t.chordType],border:"1px solid",borderColor:u?"rgba(0,0,0,0.2)":"transparent"}),onClick:function(){n(t,o,i,c),a(t.chordName),console.log(t)},onMouseOver:function(){l(t.chordNotesForOctave)}},r.a.createElement("div",null,t.chordName,!1,r.a.createElement("div",null,r.a.createElement("small",null,t.chordNotesForOctave.join()),!1)))});function ne(e){var t=e.audioApi,n=r.a.useCallback(function(){return t.actx.resume()},[t]),a=r.a.useCallback(function(){return t.actx.suspend()},[t]),o=w("key","C",k.string),i=Object(s.a)(o,2),c=i[0],u=i[1],l=w("strumming",B[2],k.integer),m=Object(s.a)(l,2),h=m[0],v=m[1],p=w("strumMode","up",k.string),g=Object(s.a)(p,2),b=g[0],y=g[1],O=w("includeExtra",!1,k.boolean),x=Object(s.a)(O,2),C=x[0],M=x[1],N=r.a.useState(null),A=Object(s.a)(N,2),L=A[0],P=A[1],F=w("octave",4,k.integer),J=Object(s.a)(F,2),Q=J[0],Y=J[1],Z=w("scaleType","major",k.string),ne=Object(s.a)(Z,2),ae=ne[0],re=ne[1],oe=r.a.useState(null),ie=Object(s.a)(oe,2),ce=ie[0],ue=ie[1],le=r.a.useCallback(function(e){return ue({keys:e,type:"chord"})}),se=r.a.useState([]),me=Object(s.a)(se,2),de=me[0],fe=me[1],he=r.a.useCallback(function(){return fe([])},[fe]),ve=r.a.useMemo(function(){return V(c,ae,Q)},[c,ae,Q]),pe=r.a.useCallback(function(){ue({keys:ve.scaleNotes,type:"scale"})},[ve]),ge=r.a.useCallback(function(){return M(function(e){return!e})}),be=r.a.useState([]),ye=Object(s.a)(be,2),Ee=ye[0],ke=ye[1],we=r.a.useState(null),je=Object(s.a)(we,2),Oe=je[0],xe=je[1],Ce=r.a.useCallback(function(){ke(function(e){var n=e,a=ve.scaleNotes.slice();a.push(f.d(a[0],"8P"));var r=t.actx.currentTime,o=0;return a.forEach(function(e){n=H(n,e,r+(o+=G),r+o+G)}),n})},[ke,t,ve]),Me=r.a.useCallback(function(e,n,a,r){var o=e.chordNotesForOctave;ke(function(e){var n=e,i=t.actx.currentTime,c=o.slice();return"down"===r?c.reverse():"random"===r&&Object(d.knuthShuffle)(c),c.forEach(function(e,t){n=H(n,e,i+t*(a/1e3),i+G+t*(a/1e3))}),n}),fe(function(t){return t.concat(e)})},[ke,t]);!function(e,t){var n=r.a.useRef(e);r.a.useEffect(function(){var a=n.current;n.current=e,a!==e&&t(e,a)},[e,t])}(ve,pe);var Ne=r.a.useMemo(function(){return Oe?(Oe.send,function(e){return Oe.send(e)}):t.dx7?function(e){return t.dx7.onMidi(e)}:function(e){}},[t,Oe]),Se=r.a.useMemo(function(){return{triggerAttack:function(e){Ne([X,f.b(e).midi,$])},triggerRelease:function(e){Ne([W,f.b(e).midi,$])}}},[Ne]);return r.a.useEffect(function(){var e=setInterval(function(){ke(function(e){return function(e,t,n){for(var a=0;a<e.length;a++){var r=e[a];if(r.time>t.actx.currentTime)break;n(r.message)}return 0===a?e:e.slice(a)}(e,t,Ne)})},1);return function(){clearInterval(e)}},[Ne]),r.a.createElement("div",{className:"App"},r.a.createElement("button",{onClick:a},"pause audio"),r.a.createElement("button",{onClick:n},"resume audio"),t.dx7&&r.a.createElement(E,{actx:t.actx,inputNode:t.dx7}),r.a.createElement(j,{selectedOutput:Oe,onChangeOutput:xe}),r.a.createElement("div",{onMouseOver:pe},r.a.createElement("label",null,"key:"," ",r.a.createElement("select",{value:ve.key,onChange:function(e){return u(e.currentTarget.value)}},K.map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,"octave:"," ",r.a.createElement("select",{value:Q,onChange:function(e){return Y(parseInt(e.currentTarget.value))}},[1,2,3,4,5,6,7].map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,"scale type:"," ",r.a.createElement("select",{value:ae,onChange:function(e){return re(e.currentTarget.value)}},U.map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,"scale notes: "),ve.scaleNotes.join()," ",r.a.createElement("button",{onClick:Ce},"play scale")," ",r.a.createElement("label",null,"strumming:",r.a.createElement("input",{type:"range",min:0,max:B.length-1,value:I[h],onChange:function(e){v(B[parseInt(e.currentTarget.value)])}})," ",r.a.createElement("input",{hidden:!0,type:"number",value:h,readOnly:!0})),r.a.createElement("label",null,"strum mode:"," ",r.a.createElement("select",{value:b,onChange:function(e){return y(e.currentTarget.value)}},["up","down","random"].map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",onChange:ge,checked:C}),"include extra chords")),r.a.createElement(S,{highlightKeys:ce?ce.keys:null,startOctave:Q,octaves:3,highlightType:ce?ce.type:"scale",notePlayer:Se}),D&&r.a.createElement("div",{style:{textAlign:"left"}},r.a.createElement("details",null,r.a.createElement("summary",{style:{textAlign:"left"}},r.a.createElement("div",{style:{display:"initial"}},"history/export")),r.a.createElement("div",{style:{padding:"8px 0"}},r.a.createElement(R,{bpm:q,history:de,strumming:h,beatDurationSeconds:G}),r.a.createElement("button",{onClick:he},"clear history")),r.a.createElement("div",{style:{width:"90vw",overflow:"auto",display:"flex"}},de.slice().reverse().map(function(e,t){return r.a.createElement("div",{key:t,style:{width:"".concat(1/7*100,"vw")}},r.a.createElement(te,{chordData:e,playChord:Me,setLastChord:function(){},octave:Q,strumming:h,strumMode:b,selected:!1,onMouseOver:le}))}),0===de.length&&r.a.createElement("div",null,"played chords will appear here")))),r.a.createElement("div",{style:_},r.a.createElement("div",{style:ee},ve.sizes.filter(function(e){return!!C||e>0}).sort(function(e,t){return T?e-t:t-e}).map(function(e,t){return r.a.createElement("div",{key:t},!1,r.a.createElement("br",null),r.a.createElement("div",{key:e,style:{display:"flex"}},Array.from(ve.scalePosChords).map(function(n){var a=Object(s.a)(n,2),o=a[0],i=a[1];return r.a.createElement("div",{key:o,style:{flex:1}},0===t&&r.a.createElement("div",null,z[ae][o]),i.filter(function(t){return t.size===e}).sort(function(e,t){return e.chordName.length-t.chordName.length}).map(function(e,t){return r.a.createElement(te,Object.assign({key:t},{chordData:e,playChord:Me,setLastChord:P,octave:Q,strumming:h,strumMode:b,selected:e.chordName===L,onMouseOver:le}))}))})))}))),r.a.createElement("pre",{style:{height:300,overflow:"auto"}},Ee.map(function(e){return JSON.stringify(e)}).join("\n")))}function ae(){var e=r.a.useState(!1),t=Object(s.a)(e,2),n=t[0],a=t[1];return r.a.useEffect(function(){n?document.documentElement.classList.add("dark-mode"):document.documentElement.classList.remove("dark-mode")},[n]),r.a.createElement("div",{style:{position:"absolute",top:0,right:0}},r.a.createElement("label",null,"dark mode:"," ",r.a.createElement("input",{type:"checkbox",checked:n,onChange:function(){return a(function(e){return!e})}})))}(new AudioContext).state;var re=function(){var e=r.a.useState(!1),t=Object(s.a)(e,2),a=t[0],o=t[1],i=r.a.useState(null),c=Object(s.a)(i,2),m=c[0],d=c[1],f=r.a.useCallback(function(){document.querySelector(".dx7").style.visibility="visible",o(!0)},[o]);return r.a.useEffect(function(){function e(){return t.apply(this,arguments)}function t(){return(t=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4),n.e(3)]).then(n.bind(null,55));case 2:(0,e.sent.sampledDX7)().then(function(e){var t=e.dx7,n=e.actx;window.initDX7Shim(t,n)});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}window.onDX7Init=function(t,n){if(!t)return e();d({dx7:t,actx:n}),"running"===n.state&&f()},L?e():window.initDX7("/scaletoy")},[]),m&&a?r.a.createElement("div",null,r.a.createElement(ne,{audioApi:m}),r.a.createElement(ae,null)):r.a.createElement("div",{className:"App"},m?r.a.createElement("button",{style:{fontSize:42,borderRadius:9,cursor:"pointer"},onClick:function(){m.actx.resume(),f()}},"start"):"loading")};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(re,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[27,1,2]]]);
//# sourceMappingURL=main.a07c99b5.chunk.js.map