(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,n){e.exports=n(24)},21:function(e,t,n){},22:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},23:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(14),o=n.n(c),i=(n(21),n(2)),u=n(4),l=(n(22),n(23),n(1)),s=n(8),m=n(9);function d(e,t){var n=[],a=e.createMediaStreamDestination(),r=new MediaRecorder(a.stream);return t.connect(a),r.ondataavailable=function(e){n.push(e.data)},r.onstop=function(e){var t=new Blob(n,{type:"audio/ogg; codecs=opus"});document.createElement("audio");!function(e,t){var n=document.createElement("a");document.body.appendChild(n),n.style="display: none";var a=URL.createObjectURL(e);n.href=a,n.download=t,n.click(),URL.revokeObjectURL(a),n.remove()}(t,"audio.ogg")},r}var f=r.a.memo(function(e){var t=r.a.useRef(d(e.actx,e.inputNode)),n=r.a.useState(!1),a=Object(i.a)(n,2),c=a[0],o=a[1],u=r.a.useCallback(function(){return o(function(e){return!e})},[o]);return r.a.useEffect(function(){c?t.current.start():"inactive"!==t.current.state&&(t.current.stop(),t.current=d(e.actx,e.inputNode))},[c]),r.a.createElement("button",{onClick:u},c?"stop recording":"record")});function v(e,t){var n="scaletoy-".concat(e),r=Object(a.useState)(function(){try{var e=window.localStorage.getItem(n);return e?JSON.parse(e):t}catch(a){return console.log(a),t}}),c=Object(i.a)(r,2),o=c[0],u=c[1];return[o,function(e){try{var t=e instanceof Function?e(o):e;u(t),window.localStorage.setItem(n,JSON.stringify(t))}catch(a){console.log(a)}}]}var p=!0,h=[0,10,30,50,75,100,150,200],b={};h.forEach(function(e,t){b[e]=t});var E=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"],g={major:["I","ii","iii","VI","V","vi","vii*"],minor:["i","ii*","III","iv","v","VI","VII"]},y={major:["major","minor","minor","major","major","minor","diminished"],minor:["minor","diminished","major","minor","minor","major","major"]};function k(e,t){return s.a(e+" "+t).notes.map(function(e,n){return a=s.b(y[t][n]),r=e,a.map(function(e){return m.a("".concat(r).concat(e))}).sort(function(e,t){return e.intervals.length-t.intervals.length}).map(function(e){return"".concat(e.tonic).concat(e.aliases[0])});var a,r})}var j=1/140*60,w=144,C=128,x=80,O=!1;function N(e){var t=function(e,t,n){var a=s.a("".concat(e).concat(t," ").concat(n)).notes;return a.push((r=l.b(a[0]),c=1,"".concat(r.pc).concat(r.oct+c))),a;var r,c}("c",4,"major"),n=0,a=null;setInterval(function(){null!=a&&e.dx7.onMidi([C,l.b(t[a]).midi,x]),e.dx7.onMidi([w,l.b(t[n]).midi,x]),a=n,n=(n+1)%t.length},1e3*j)}function I(e,t,n,a){var r=l.b(t).midi,c=e;return e.forEach(function(e){e.message[1]==r&&(e.time=n-.01,e.message[0]=C)}),function(e,t){var n=e.concat(t);return n.sort(function(e,t){return e.time-t.time}),n}(c,[{message:[w,r,x],time:n},{message:[C,r,x],time:a}])}function S(e,t){var n=m.a(e),a=t[n.tonic];return n.intervals.map(function(e){return l.d(a,e)})}function T(e,t,n){var a=s.a("".concat(e," ").concat(t)),r=a.notes,c=function(e,t){return e.intervals.map(function(n){return l.d("".concat(e.tonic).concat(t),n)})}(a,n),o={};c.forEach(function(e){o[l.b(e).pc]=e});var i=new Map(k(e,t).map(function(e,n){return[n,e.map(function(e){var a=m.a(e);return{pos:n,chord:a,chordType:y[t][n],chordNotesForOctave:S(e,o),chordName:e,size:a.intervals.length*("Unknown"===a.quality?-1:1)}})]})),u=new Map(Array.from(i.values).map(function(e){return[e.chordName,e]})),d=new Set;return i.forEach(function(e,t){e.forEach(function(e){d.add(e.size)})}),{scaleType:t,key:e,scalePitchClasses:r,scalePosChords:i,scaleNotes:c,chordDatasByName:u,sizes:Array.from(d).sort(function(e,t){return e-t})}}var D={major:"rgb(127,199,175)",minor:"rgb(255,158,157)",diminished:"rgb(218,216,167)"},A={display:"block",width:"100%",cursor:"pointer",color:"black",padding:4,paddingBottom:8,height:46,overflow:"hidden"},B={display:"flex"},M={flex:1},L=r.a.memo(function(e){var t=e.chordData,n=e.playChord,a=e.setLastChord,c=e.octave,o=e.strumming,i=e.selected;return r.a.createElement("div",{style:Object(u.a)({},A,{background:D[t.chordType],border:"1px solid",borderColor:i?"rgba(0,0,0,0.2)":"transparent"}),onClick:function(){n(t,c,o),a(t.chordName),console.log(t)}},r.a.createElement("div",null,t.chordName,!1,r.a.createElement("div",null,r.a.createElement("small",null,t.chordNotesForOctave.join()),!1)))});function R(e){var t=e.audioApi,n=r.a.useCallback(function(){return t.actx.resume()},[t]),a=r.a.useCallback(function(){return t.actx.suspend()},[t]),c=v("key","C"),o=Object(i.a)(c,2),u=o[0],s=o[1],m=v("strumming",h[2]),d=Object(i.a)(m,2),y=d[0],k=d[1],w=v("includeExtra",!1),C=Object(i.a)(w,2),x=C[0],O=C[1],N=r.a.useState(null),S=Object(i.a)(N,2),D=S[0],A=S[1],R=v("octave",4),z=Object(i.a)(R,2),F=z[0],J=z[1],U=v("scaleType","major"),P=Object(i.a)(U,2),V=P[0],G=P[1],W=r.a.useState([]),X=Object(i.a)(W,2),q=X[0],$=X[1],H=r.a.useMemo(function(){return T(u,V,F)},[u,V,F]),K=r.a.useCallback(function(){return O(function(e){return!e})}),Q=r.a.useState([]),Y=Object(i.a)(Q,2),Z=Y[0],_=Y[1],ee=r.a.useCallback(function(){_(function(e){var n=e,a=H.scaleNotes.slice();a.push(l.d(a[0],"8P"));var r=t.actx.currentTime,c=0;return a.forEach(function(e){n=I(n,e,r+(c+=j),r+c+j)}),n})},[_,t,H]),te=r.a.useCallback(function(e,n,a){var r=e.chordNotesForOctave;_(function(e){var n=e,c=t.actx.currentTime;return r.forEach(function(e,t){n=I(n,e,c+t*(a/1e3),c+j+t*(a/1e3))}),n}),$(function(t){return t.concat(e)})},[_,t]);return r.a.useEffect(function(){setInterval(function(){_(function(e){return function(e,t){for(var n=0;n<e.length;n++){var a=e[n];if(a.time>t.actx.currentTime)break;t.dx7.onMidi(a.message)}return 0===n?e:e.slice(n)}(e,t)})},1)},[]),r.a.createElement("div",{className:"App"},r.a.createElement("button",{onClick:a},"pause audio"),r.a.createElement("button",{onClick:n},"resume audio"),r.a.createElement(f,{actx:t.actx,inputNode:t.dx7}),r.a.createElement("div",null,r.a.createElement("label",null,"key:"," ",r.a.createElement("select",{value:H.key,onChange:function(e){return s(e.currentTarget.value)}},E.map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,"octave:"," ",r.a.createElement("select",{value:F,onChange:function(e){return J(parseInt(e.currentTarget.value))}},[1,2,3,4,5,6,7].map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,"scale type:"," ",r.a.createElement("select",{value:V,onChange:function(e){return G(e.currentTarget.value)}},["major","minor"].map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,"scale notes: "),H.scaleNotes.join()," ",r.a.createElement("button",{onClick:ee},"play scale")," ",r.a.createElement("label",null,"strumming:",r.a.createElement("input",{type:"range",min:0,max:9,value:b[y],onChange:function(e){k(h[parseInt(e.currentTarget.value)])}})," ",r.a.createElement("input",{hidden:!0,type:"number",value:y,readOnly:!0})),r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",onChange:K,checked:x}),"include extra chords")),r.a.createElement("div",{style:B},r.a.createElement("div",{style:M},H.sizes.filter(function(e){return!!x||e>0}).sort(function(e,t){return p?e-t:t-e}).map(function(e,t){return r.a.createElement("div",{key:t},!1,r.a.createElement("br",null),r.a.createElement("div",{key:e,style:{display:"flex"}},Array.from(H.scalePosChords).map(function(n){var a=Object(i.a)(n,2),c=a[0],o=a[1];return r.a.createElement("div",{key:c,style:{flex:1}},0===t&&r.a.createElement("div",null,g[V][c]),o.filter(function(t){return t.size===e}).sort(function(e,t){return e.chordName.length-t.chordName.length}).map(function(e,t){return r.a.createElement(L,Object.assign({key:t},{chordData:e,playChord:te,setLastChord:A,octave:F,strumming:y,selected:e.chordName===D}))}))})))})),r.a.createElement("div",{style:{width:"10vw"}},r.a.createElement("details",null,r.a.createElement("summary",null,r.a.createElement("div",null,"history")),r.a.createElement("div",{style:{height:"90vh",overflow:"auto"}},q.slice().reverse().map(function(e,t){return r.a.createElement(L,Object.assign({key:t},{chordData:e,playChord:te,setLastChord:function(){},octave:F,strumming:y,selected:!1}))}),0===q.length&&r.a.createElement("div",null,r.a.createElement("br",null),"played chords will appear here"))))),r.a.createElement("pre",{style:{height:300,overflow:"auto"}},Z.map(function(e){return JSON.stringify(e)}).join("\n")))}var z=function(){var e=r.a.useState(!1),t=Object(i.a)(e,2),n=t[0],a=t[1],c=r.a.useState(null),o=Object(i.a)(c,2),u=o[0],l=o[1];return r.a.useEffect(function(){window.onDX7Init=function(e,t){var n={dx7:e,actx:t};O&&N(n),l(n)},initDX7("/scaletoy")},[]),u&&n?r.a.createElement(R,{audioApi:u}):r.a.createElement("div",{className:"App"},u?r.a.createElement("button",{style:{fontSize:42,borderRadius:9,cursor:"pointer"},onClick:function(){document.getElementById("content").style.visibility="visible",u.actx.resume(),a(!0)}},"start"):"loading")};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[15,1,2]]]);
//# sourceMappingURL=main.947b2a5a.chunk.js.map