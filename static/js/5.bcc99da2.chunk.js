(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{69:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(3),i=n(14),o=n(0),c=n.n(o),l=n(33),u=n(5),s=n(19),m=n(9);Math.log(2),Math.log(440);var d="C C# D D# E F F# G G# A A# B".split(" "),f="C Db D Eb E F Gb G Ab A Bb B".split(" ");var p=n(13),h=n(25),g=n(30),v=n(6),y=n(31),b=n(32),k=n(15),E=n(11),x=10,w=10,N=10;function M(e,t,n){return Math.max(Math.min(e,n),t)}function O(e){var t=e.currentTarget.getBoundingClientRect();return{x:M(e.pageX-(t.x+window.scrollX),0,t.width),y:M(e.pageY-(t.y+window.scrollY),0,t.height)}}function j(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y);return{left:t,top:n,width:Math.max(e.start.x,e.end.x)-t,height:Math.max(e.start.y,e.end.y)-n}}function S(e){var t=e.midi,n=e.extents,a=e.track,o=e.trackIdx,l=e.tracksWidth,s=e.midiRange,m=e.selectedNotes,p=e.setSelectedNotes,h=e.zoom,g=e.scaleNotes,v=c.a.useRef({start:{x:0,y:0},end:{x:0,y:0},dragging:!1}),y=c.a.useRef(null);function b(){var e=y.current,t=v.current;if(e&&t){e.style.visibility=t.dragging?"visible":"hidden";var n=j(t);e.style.left=n.left+"px",e.style.top=n.top+"px",e.style.width=n.width+"px",e.style.height=n.height+"px"}}var k=c.a.useCallback(function(e){return{left:e.ticks/t.header.ppq*w*h,top:(s-(e.midi-n.minNote))*x,width:e.durationTicks/t.header.ppq*w*h,height:x}},[t.header.ppq,n.minNote,s,h]),M=c.a.useCallback(function(){var e=v.current;if(e){var t=j(e),n=a.notes.filter(function(e){return function(e,t){var n=e.left,a=e.top,r=e.left+e.width,i=e.top+e.height,o=t.left,c=t.top,l=t.left+t.width,u=t.top+t.height;return!(n>l||o>r||a>u||c>i)}(k(e),t)});p(new Set(n))}},[a,k,p]),S=c.a.useCallback(function(e){v.current={start:O(e),end:O(e),dragging:!0},b()},[]),C=c.a.useCallback(function(e){var t=v.current;t&&t.dragging&&(t.end=O(e),b())},[]),A=c.a.useCallback(function(){var e=v.current;e&&e.dragging&&(e.dragging=!1,M()),b()},[M]);return c.a.createElement("div",{style:{overflowX:"scroll"}},c.a.createElement("div",{onMouseDown:S,onMouseMove:C,onMouseUp:A,onMouseLeave:A,style:{height:(s+1)*x+1+N,width:l*h,position:"relative",borderBottom:"solid #555 1px"}}," ",Object(i.a)(Array(s+1).keys()).map(function(e){var t=s-e+n.minNote,a=Object(E.a)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=Math.round(e);var n=(!0===t.sharps?d:f)[e%12];return t.pitchClass?n:n+(Math.floor(e/12)-1)}(t)),r=Object(E.a)(u.a(a).pc);return c.a.createElement("div",{key:"track"+o+"row"+e,style:{height:x,background:g.has(r)?"rgba(199,200,0,1)":""===u.a(a).acc?"#555":"#333",borderTop:"solid #222 1px",overflow:"hidden"}},c.a.createElement("div",{style:{marginTop:-1,fontSize:9,fontFamily:"Lucida Grande",position:"fixed",left:0}},a))}),a.notes.map(function(e,t){return c.a.createElement("div",{key:"track"+o+"note"+t,style:Object(r.a)({},k(e),{background:m.has(e)?"red":"rgba(80,100,255,1)",border:"solid 1px darkblue ",position:"absolute"})})}),c.a.createElement("div",{ref:y,style:{background:"rgba(200,200,200,0.3)",border:"solid 1px white",position:"absolute"}})))}function C(e){var t=e.midi,n=e.selectedNotes,a=e.setSelectedNotes,r=e.zoom,i=e.scaleNotes,o=c.a.useMemo(function(){return t.tracks.map(function(e){return 0===e.notes.length?{minNote:0,maxNote:12,maxTicks:0}:e.notes.reduce(function(e,t){var n=Math.min(e.minNote,t.midi);return{minNote:n,maxNote:Math.max(e.maxNote,t.midi,n+12),maxTicks:Math.max(e.maxTicks,t.ticks+t.durationTicks)}},{minNote:127,maxNote:0,maxTicks:0})})},[t.tracks]),l=c.a.useMemo(function(){return o.reduce(function(e,t){return Math.max(t.maxTicks,e)},0)/t.header.ppq*w},[o,t.header.ppq]);return c.a.createElement("div",{style:{textAlign:"left"}},t.tracks.map(function(e,u){var s=o[u],m=s.maxNote-s.minNote;return c.a.createElement(k.a,{key:u,startOpen:!1,summary:c.a.createElement(c.a.Fragment,null,"Track ",u+1,":"," ",e.instrument&&e.instrument.name)},c.a.createElement(S,{midi:t,extents:s,track:e,trackIdx:u,tracksWidth:l,midiRange:m,selectedNotes:n,setSelectedNotes:a,zoom:r,scaleNotes:i}))}))}var A=n(16);function T(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}n.d(t,"default",function(){return P});var B=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"],F=["major","minor","dorian","lydian","phrygian","ionian","mixolydian","locrian"],R=4,G=144,J=128,z=80;function q(e){var t=e.scaleData,n=e.selectedNotes,a=e.notePlayer,r=Object(i.a)(new Set(Object(i.a)(n).map(function(e){return u.a(e.name).pc}))).map(E.a),o=t.keyScales.filter(function(e){var t,n=e.notes.map(E.a),a=T(r);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!n.includes(i))return!1}}catch(o){a.e(o)}finally{a.f()}return!0});return c.a.createElement("div",null,c.a.createElement("div",null,"Notes: ",r.join(", ")),c.a.createElement("div",null,"Chord:",p.a(r).join(", ")),c.a.createElement(k.a,{summary:"Matching Scales:"},o.map(function(e){var t=I(e,R);return c.a.createElement("div",{key:e.name},e.name,c.a.createElement("br",null),c.a.createElement(b.a,{highlightKeys:t,startOctave:R,octaves:3,highlightType:"scale",notePlayer:a}))})))}function I(e,t){return e.intervals.map(function(n){return Object(E.a)(u.b("".concat(e.tonic).concat(t),n))})}function P(e){var t=e.audioApi,n=function(){var e=Object(g.a)("MidiExploderPersistence",null),t=Object(a.a)(e,2),n=t[0],r=t[1];return[c.a.useMemo(function(){if(null!=n)try{var e=new l.Midi;return e.fromJSON(n),e}catch(t){return console.error("failed to load midi file",t),null}},[n]),function(e){r(e.toJSON())}]}(),o=Object(a.a)(n,2),d=o[0],f=o[1],p=Object(v.b)("key","C",v.a.string),k=Object(a.a)(p,2),x=k[0],w=k[1],N=Object(v.b)("scaleType","major",v.a.string),M=Object(a.a)(N,2),O=M[0],j=M[1],S=Object(g.a)("MidiExploderZoom",1),T=Object(a.a)(S,2),D=T[0],P=T[1],Y=Object(g.a)("MidiExploderHighlightScale",!1),W=Object(a.a)(Y,2),X=W[0],K=W[1],L=c.a.useCallback(function(e){if(e.currentTarget.files){var t=Object(a.a)(e.currentTarget.files,1)[0];if(t){var n=new FileReader;n.onload=function(){f(new l.Midi(n.result)),P(1)},n.readAsArrayBuffer(t)}}},[f,P]),U=c.a.useMemo(function(){return function(e,t,n){var a=s.a("".concat(e," ").concat(t)),i=I(a,n),o=h.a().map(function(t){return s.a("".concat(e," ").concat(t.name))}).map(function(e){return Object(r.a)({},e,{notesAbstractMidi:new Set(e.notes.map(function(e){return u.a("".concat(e,"0")).midi}).sort())})});return{scale:a,scaleNotes:i,key:e,keyScales:o}}(x,O,R)},[x,O]),H=c.a.useState(null),Z=Object(a.a)(H,2),$=Z[0],Q=Z[1],V=c.a.useCallback(function(){Q({keys:U.scaleNotes,type:"scale"})},[U]);Object(y.a)(U,V);var _=c.a.useMemo(function(){return t.dx7?function(e){return t.dx7.onMidi(e)}:function(e){}},[t]),ee=c.a.useMemo(function(){return{triggerAttack:function(e){_([G,u.a(e).midi,z])},triggerRelease:function(e){_([J,u.a(e).midi,z])}}},[_]),te=c.a.useState(new Set),ne=Object(a.a)(te,2),ae=ne[0],re=ne[1];return c.a.useEffect(function(){var e=new Set(Object(i.a)(ae).map(function(e){return e.midi}));function t(){e.forEach(function(e){ee.triggerRelease(m.b(e))})}e.forEach(function(e){ee.triggerAttack(m.b(e))});var n=setTimeout(function(){t()},500);return function(){clearTimeout(n),t()}},[ee,ae]),c.a.createElement("div",{className:"App"},c.a.createElement("div",{style:{display:"flex",flexDirection:"row",gap:8,flexWrap:"wrap",padding:8,background:"#777",margin:8}},c.a.createElement("label",null,"midi file: ",c.a.createElement("input",{type:"file",onChange:L})),c.a.createElement(A.a,{label:"highlight scale",checked:X,onChange:function(){return K(function(e){return!e})}}),c.a.createElement("label",null,"key:"," ",c.a.createElement("select",{value:U.key,onChange:function(e){return w(e.currentTarget.value)}},B.map(function(e){return c.a.createElement("option",{key:e,value:e},e)}))),c.a.createElement("label",null,"scale type:"," ",c.a.createElement("select",{value:O,onChange:function(e){return j(e.currentTarget.value)}},F.map(function(e){return c.a.createElement("option",{key:e,value:e},e)}))),c.a.createElement("div",{onMouseOver:V},c.a.createElement("label",null,"scale notes: "),U.scaleNotes.map(function(e){return m.c(e)}).join()," "),c.a.createElement(b.a,{highlightKeys:$?$.keys:null,startOctave:R,octaves:3,highlightType:$?$.type:"scale",notePlayer:ee}),c.a.createElement("div",null,"zoom:",c.a.createElement("button",{onClick:function(){P(function(e){return 1.05*e})}},"+"),c.a.createElement("button",{onClick:function(){P(function(e){return e*(1/1.05)})}},"-"))),c.a.createElement("details",{open:!1,style:{textAlign:"left"}},c.a.createElement("summary",null,"JSON"),c.a.createElement("pre",null,d&&JSON.stringify(d.toJSON(),null,2))),null!=d&&c.a.createElement("div",{style:{display:"flex"}},c.a.createElement("div",{style:{overflowY:"auto",width:"66%"}},c.a.createElement(C,{midi:d,selectedNotes:ae,setSelectedNotes:re,zoom:D,scaleNotes:X?new Set(U.scale.notes.map(E.a)):new Set})),c.a.createElement("div",{style:{width:"33%",overflowY:"auto"}},c.a.createElement(q,{scaleData:U,selectedNotes:ae,notePlayer:ee}))))}}}]);
//# sourceMappingURL=5.bcc99da2.chunk.js.map