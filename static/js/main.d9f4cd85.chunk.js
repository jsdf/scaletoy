(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{20:function(e,t,n){e.exports=n(29)},25:function(e,t,n){},27:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},28:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(17),c=n.n(o),i=(n(25),n(14)),u=n.n(i),l=n(16),s=n(1),m=n(3),d=(n(27),n(28),n(2)),f=n(8),h=n(9);function v(e,t){var n=[],a=e.createMediaStreamDestination(),r=new MediaRecorder(a.stream);return t.connect(a),r.ondataavailable=function(e){n.push(e.data)},r.onstop=function(e){var t=new Blob(n,{type:"audio/ogg; codecs=opus"});document.createElement("audio");!function(e,t){var n=document.createElement("a");document.body.appendChild(n),n.style="display: none";var a=URL.createObjectURL(e);n.href=a,n.download=t,n.click(),URL.revokeObjectURL(a),n.remove()}(t,"audio.ogg")},r}function p(e){var t=r.a.useRef(v(e.actx,e.inputNode)),n=r.a.useState(!1),a=Object(s.a)(n,2),o=a[0],c=a[1],i=r.a.useCallback(function(){return c(function(e){return!e})},[c]);return r.a.useEffect(function(){o?t.current.start():"inactive"!==t.current.state&&(t.current.stop(),t.current=v(e.actx,e.inputNode))},[o]),r.a.createElement("button",{onClick:i},o?"stop recording":"record audio")}var g=r.a.memo(function(e){return"undefined"==typeof MediaRecorder?r.a.createElement("button",{disabled:!0},"[recording not available]"):r.a.createElement(p,e)});function b(e,t){var n="scaletoy-".concat(e),r=Object(a.useState)(function(){try{var e=window.localStorage.getItem(n);return e?JSON.parse(e):t}catch(a){return console.log(a),t}}),o=Object(s.a)(r,2),c=o[0],i=o[1];return[c,function(e){try{var t=e instanceof Function?e(c):e;i(t),window.localStorage.setItem(n,JSON.stringify(t))}catch(a){console.log(a)}}]}function y(e){var t=e.onChangeOutput,n=e.selectedOutput,a=r.a.useState([]),o=Object(s.a)(a,2),c=o[0],i=o[1];return r.a.useEffect(function(){navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then(function(e){i(Array.from(e.outputs.values())),e.onstatechange=function(t){i(Array.from(e.outputs.values()))}})},[]),r.a.createElement("label",null,"midi out:"," ",r.a.createElement("select",{onChange:function(e){t(c[parseInt(e.currentTarget.value)])},value:c.indexOf(n)},r.a.createElement("option",{key:-1,value:-1},"(none)"),c.map(function(e,t){return r.a.createElement("option",{key:t,value:t},e.name)})))}var E=n(18);var k=["C","D","E","F","G","A","B"],j=new Set(["C","D","F","G","A"]),w={container:{textAlign:"center"},keyboard:{display:"inline-block",position:"relative",height:70,marginTop:20},whiteKey:{position:"absolute",borderBottomLeftRadius:4,borderBottomRightRadius:4,width:20,height:70,background:"white",border:"solid 1px black",zIndex:0},noteLabel:{width:20,marginTop:70},highlighted:{background:"orange"},blackKey:{position:"absolute",borderBottomLeftRadius:3,borderBottomRightRadius:3,width:9,height:50,background:"black",border:"solid 1px black",zIndex:1}};var O=r.a.memo(function(e){var t=k.length*e.octaves,n=[];return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(E.a)(Array(e).keys()).map(function(e){return e+t})}(e.octaves,e.startOctave).forEach(function(t,a){k.forEach(function(o,c){var i=o+t,u=o+"#"+t;n.push(r.a.createElement("div",{key:i,style:Object(m.a)({},w.whiteKey,e.highlightKeys&&e.highlightKeys.includes(i)?w.highlighted:null,{left:(a*k.length+c)*(w.whiteKey.width-1)})},r.a.createElement("div",{style:w.noteLabel},i))),j.has(o)&&n.push(r.a.createElement("div",{key:u,style:Object(m.a)({},w.blackKey,e.highlightKeys&&e.highlightKeys.includes(u)?w.highlighted:null,{left:(a*k.length+c+1)*(w.whiteKey.width-1)-(w.blackKey.width-1)/2})}))})}),r.a.createElement("div",{style:w.container},r.a.createElement("div",{style:Object(m.a)({},w.keyboard,{width:t*w.whiteKey.width})},n))}),x=!0,C=!1,N=Boolean(new URL(document.location).searchParams.get("sampled")),S=[0,10,30,50,75,100,150,200],A={};S.forEach(function(e,t){A[e]=t});var R=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"],D={major:["major","minor","minor","major","major","minor","diminished"],minor:["minor","diminished","major","minor","minor","major","major"],dorian:["minor","minor","major","major","minor","diminished","major"],lydian:["major","major","minor","diminished","major","minor","minor"],phrygian:["minor","major","major","minor","diminished","major","minor"],ionian:["major","minor","minor","major","major","minor","diminished"],mixolydian:["major","minor","diminished","major","minor","minor","major"],locrian:["diminished","major","minor","minor","major","major","minor"]},I=Object.keys(D),T=["i","ii","iii","iv","v","vi","vii"],L=Object.keys(D).reduce(function(e,t){var n=D[t];return e[t]=n.map(function(e,t){var n=T[t];switch(e){case"major":return n.toUpperCase();case"minor":return n;case"diminished":return n+"\xb0";default:throw new Error("unknown scaleType '".concat(e,"'"))}}),e},{});function M(e,t){return f.a(e+" "+t).notes.map(function(e,n){return a=f.b(D[t][n]),r=e,a.map(function(e){return h.a("".concat(r).concat(e))}).sort(function(e,t){return e.intervals.length-t.intervals.length}).map(function(e){return"".concat(e.tonic).concat(e.aliases[0])});var a,r})}var B=1/140*60,K=144,F=128,z=80;function U(e,t,n,a){var r=d.b(t).midi,o=e;return e.forEach(function(e){e.message[1]==r&&(e.time=n-.01,e.message[0]=F)}),function(e,t){var n=e.concat(t);return n.sort(function(e,t){return e.time-t.time}),n}(o,[{message:[K,r,z],time:n},{message:[F,r,z],time:a}])}function P(e,t){var n=h.a(e),a=t[n.tonic];return n.intervals.map(function(e){return d.d(a,e)})}function J(e,t,n){var a=f.a("".concat(e," ").concat(t)),r=a.notes,o=function(e,t){return e.intervals.map(function(n){return d.d("".concat(e.tonic).concat(t),n)})}(a,n),c={};o.forEach(function(e){c[d.b(e).pc]=e});var i=new Map(M(e,t).map(function(e,n){return[n,e.map(function(e){var a=h.a(e);return{pos:n,chord:a,chordType:D[t][n],chordNotesForOctave:P(e,c),chordName:e,size:a.intervals.length*("Unknown"===a.quality?-1:1)}})]})),u=new Map(Array.from(i.values).map(function(e){return[e.chordName,e]})),l=new Set;return i.forEach(function(e,t){e.forEach(function(e){l.add(e.size)})}),{scaleType:t,key:e,scalePitchClasses:r,scalePosChords:i,scaleNotes:o,chordDatasByName:u,sizes:Array.from(l).sort(function(e,t){return e-t})}}var q={major:"rgb(127,199,175)",minor:"rgb(255,158,157)",diminished:"rgb(218,216,167)"},G={display:"block",width:"100%",cursor:"pointer",color:"black",padding:4,paddingBottom:8,height:46,overflow:"hidden"},X={display:"flex"},W={flex:1},$=r.a.memo(function(e){var t=e.chordData,n=e.playChord,a=e.setLastChord,o=e.octave,c=e.strumming,i=e.selected,u=e.onMouseOver;return r.a.createElement("div",{style:Object(m.a)({},G,{background:q[t.chordType],border:"1px solid",borderColor:i?"rgba(0,0,0,0.2)":"transparent"}),onClick:function(){n(t,o,c),a(t.chordName),console.log(t)},onMouseOver:function(){u(t.chordNotesForOctave)}},r.a.createElement("div",null,t.chordName,!1,r.a.createElement("div",null,r.a.createElement("small",null,t.chordNotesForOctave.join()),!1)))});function H(e){var t=e.audioApi,n=r.a.useCallback(function(){return t.actx.resume()},[t]),a=r.a.useCallback(function(){return t.actx.suspend()},[t]),o=b("key","C"),c=Object(s.a)(o,2),i=c[0],u=c[1],l=b("strumming",S[2]),m=Object(s.a)(l,2),f=m[0],h=m[1],v=b("includeExtra",!1),p=Object(s.a)(v,2),E=p[0],k=p[1],j=r.a.useState(null),w=Object(s.a)(j,2),N=w[0],D=w[1],T=b("octave",4),M=Object(s.a)(T,2),K=M[0],F=M[1],z=b("scaleType","major"),P=Object(s.a)(z,2),q=P[0],G=P[1],H=r.a.useState(null),Q=Object(s.a)(H,2),V=Q[0],Y=Q[1],Z=r.a.useState([]),_=Object(s.a)(Z,2),ee=_[0],te=_[1],ne=r.a.useMemo(function(){return J(i,q,K)},[i,q,K]),ae=r.a.useCallback(function(){return k(function(e){return!e})}),re=r.a.useState([]),oe=Object(s.a)(re,2),ce=oe[0],ie=oe[1],ue=r.a.useState(null),le=Object(s.a)(ue,2),se=le[0],me=le[1],de=r.a.useCallback(function(){ie(function(e){var n=e,a=ne.scaleNotes.slice();a.push(d.d(a[0],"8P"));var r=t.actx.currentTime,o=0;return a.forEach(function(e){n=U(n,e,r+(o+=B),r+o+B)}),n})},[ie,t,ne]),fe=r.a.useCallback(function(e,n,a){var r=e.chordNotesForOctave;ie(function(e){var n=e,o=t.actx.currentTime;return r.forEach(function(e,t){n=U(n,e,o+t*(a/1e3),o+B+t*(a/1e3))}),n}),te(function(t){return t.concat(e)})},[ie,t]);return function(e,t){var n=r.a.useRef(e);r.a.useEffect(function(){var a=n.current;n.current=e,a!==e&&t(e,a)},[e])}(ne,function(){Y(ne.scaleNotes)}),r.a.useEffect(function(){var e=setInterval(function(){ie(function(e){return function(e,t,n){for(var a=0;a<e.length;a++){var r=e[a];if(r.time>t.actx.currentTime)break;n?(n.send,n.send(r.message)):t.dx7&&t.dx7.onMidi(r.message)}return 0===a?e:e.slice(a)}(e,t,se)})},1);return function(){clearInterval(e)}},[se]),r.a.createElement("div",{className:"App"},r.a.createElement("button",{onClick:a},"pause audio"),r.a.createElement("button",{onClick:n},"resume audio"),t.dx7&&r.a.createElement(g,{actx:t.actx,inputNode:t.dx7}),r.a.createElement(y,{selectedOutput:se,onChangeOutput:me}),r.a.createElement("div",{onMouseOver:function(){return Y(ne.scaleNotes)}},r.a.createElement("label",null,"key:"," ",r.a.createElement("select",{value:ne.key,onChange:function(e){return u(e.currentTarget.value)}},R.map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,"octave:"," ",r.a.createElement("select",{value:K,onChange:function(e){return F(parseInt(e.currentTarget.value))}},[1,2,3,4,5,6,7].map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,"scale type:"," ",r.a.createElement("select",{value:q,onChange:function(e){return G(e.currentTarget.value)}},I.map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))," ",r.a.createElement("label",null,"scale notes: "),ne.scaleNotes.join()," ",r.a.createElement("button",{onClick:de},"play scale")," ",r.a.createElement("label",null,"strumming:",r.a.createElement("input",{type:"range",min:0,max:9,value:A[f],onChange:function(e){h(S[parseInt(e.currentTarget.value)])}})," ",r.a.createElement("input",{hidden:!0,type:"number",value:f,readOnly:!0})),r.a.createElement("label",null,r.a.createElement("input",{type:"checkbox",onChange:ae,checked:E}),"include extra chords")),r.a.createElement(O,{highlightKeys:V,startOctave:K,octaves:3}),r.a.createElement("div",{style:X},r.a.createElement("div",{style:W},ne.sizes.filter(function(e){return!!E||e>0}).sort(function(e,t){return x?e-t:t-e}).map(function(e,t){return r.a.createElement("div",{key:t},!1,r.a.createElement("br",null),r.a.createElement("div",{key:e,style:{display:"flex"}},Array.from(ne.scalePosChords).map(function(n){var a=Object(s.a)(n,2),o=a[0],c=a[1];return r.a.createElement("div",{key:o,style:{flex:1}},0===t&&r.a.createElement("div",null,L[q][o]),c.filter(function(t){return t.size===e}).sort(function(e,t){return e.chordName.length-t.chordName.length}).map(function(e,t){return r.a.createElement($,Object.assign({key:t},{chordData:e,playChord:fe,setLastChord:D,octave:K,strumming:f,selected:e.chordName===N,onMouseOver:Y}))}))})))})),C&&r.a.createElement("div",{style:{width:"10vw"}},r.a.createElement("details",null,r.a.createElement("summary",null,r.a.createElement("div",null,"history")),r.a.createElement("div",{style:{height:"90vh",overflow:"auto"}},ee.slice().reverse().map(function(e,t){return r.a.createElement($,Object.assign({key:t},{chordData:e,playChord:fe,setLastChord:function(){},octave:K,strumming:f,selected:!1,onMouseOver:Y}))}),0===ee.length&&r.a.createElement("div",null,r.a.createElement("br",null),"played chords will appear here"))))),r.a.createElement("pre",{style:{height:300,overflow:"auto"}},ce.map(function(e){return JSON.stringify(e)}).join("\n")))}function Q(){var e=r.a.useState(!1),t=Object(s.a)(e,2),n=t[0],a=t[1];return r.a.useEffect(function(){n?document.documentElement.classList.add("dark-mode"):document.documentElement.classList.remove("dark-mode")},[n]),r.a.createElement("div",{style:{position:"absolute",top:0,right:0}},r.a.createElement("label",null,"dark mode:"," ",r.a.createElement("input",{type:"checkbox",checked:n,onChange:function(){return a(function(e){return!e})}})))}(new AudioContext).state;var V=function(){var e=r.a.useState(!1),t=Object(s.a)(e,2),a=t[0],o=t[1],c=r.a.useState(null),i=Object(s.a)(c,2),m=i[0],d=i[1],f=r.a.useCallback(function(){document.querySelector(".dx7").style.visibility="visible",o(!0)},[o]);return r.a.useEffect(function(){function e(){return t.apply(this,arguments)}function t(){return(t=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4),n.e(3)]).then(n.bind(null,39));case 2:(0,e.sent.sampledDX7)().then(function(e){var t=e.dx7,n=e.actx;window.initDX7Shim(t,n)});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}window.onDX7Init=function(t,n){if(!t)return e();d({dx7:t,actx:n}),"running"===n.state&&f()},N?e():window.initDX7("/scaletoy")},[]),m&&a?r.a.createElement("div",null,r.a.createElement(H,{audioApi:m}),r.a.createElement(Q,null)):r.a.createElement("div",{className:"App"},m?r.a.createElement("button",{style:{fontSize:42,borderRadius:9,cursor:"pointer"},onClick:function(){m.actx.resume(),f()}},"start"):"loading")};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(V,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[20,1,2]]]);
//# sourceMappingURL=main.d9f4cd85.chunk.js.map