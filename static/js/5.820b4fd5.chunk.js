(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{63:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(3),i=n(13),o=n(0),m=n.n(o),c=n(28),l=n(2),u=n(11),s=n(9),d=n(22),P=n(15),M=n(14);function f(e){return"object"===typeof e&&"string"===typeof e.name}function p(e){return"object"===typeof e&&"number"===typeof e.step&&"number"===typeof e.alt}var h=[0,2,4,-1,1,3,5],y=h.map(function(e){return Math.floor(7*e/12)});function v(e){var t=e.step,n=e.alt,a=e.oct,r=e.dir,i=void 0===r?1:r,o=h[t]+7*n;return void 0===a?[i*o]:[i*o,i*(a-y[t]-4*n)]}var b={empty:!0,name:"",pc:"",acc:""},g={},A=function(e,t){return Array(t+1).join(e)},k=function(e){return"CDEFGAB".charAt(e)},x=function(e){return e<0?A("b",-e):A("#",e)},j=function(e){return"b"===e[0]?-e.length:e.length};function w(e){return"string"===typeof e?g[e]||(g[e]=function(e){var t=function(e){var t=E.exec(e);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}(e);if(""===t[0]||""!==t[3])return b;var n=t[0],a=t[1],r=t[2],i=(n.charCodeAt(0)+3)%7,o=j(a),m=r.length?+r:void 0,c=v({step:i,alt:o,oct:m}),l=n+a+r,u=n+a,s=(N[i]+o+120)%12,d=void 0===m?-100:m,P=N[i]+o+12*(d+1),M=P>=0&&P<=127?P:null,f=void 0===m?null:440*Math.pow(2,(P-69)/12);return{empty:!1,acc:a,alt:o,chroma:s,coord:c,freq:f,height:P,letter:n,midi:M,name:l,oct:m,pc:u,step:i}}(e)):p(e)?w(function(e){var t=e.step,n=e.alt,a=e.oct,r=k(t);if(!r)return"";var i=r+x(n);return a||0===a?i+a:i}(e)):f(e)?w(e.name):b}var E=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;var N=[0,2,4,5,7,9,11];var O={empty:!0,name:"",acc:""},S=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$");var T={};function C(e){return"string"===typeof e?T[e]||(T[e]=function(e){var t=function(e){var t=S.exec("".concat(e));return null===t?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}(e);if(""===t[0])return O;var n=+t[0],a=t[1],r=(Math.abs(n)-1)%7,i=q[r];if("M"===i&&"P"===a)return O;var o="M"===i?"majorable":"perfectable",m=""+n+a,c=n<0?-1:1,l=8===n||-8===n?n:c*(r+1),u=function(e,t){return"M"===t&&"majorable"===e||"P"===t&&"perfectable"===e?0:"m"===t&&"majorable"===e?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*("perfectable"===e?t.length:t.length+1):0}(o,a),s=Math.floor((Math.abs(n)-1)/7),d=c*(R[r]+u+12*s),P=(c*(R[r]+u)%12+12)%12,M=v({step:r,alt:u,oct:s,dir:c});return{empty:!1,name:m,num:n,q:a,step:r,alt:u,dir:c,type:o,simple:l,semitones:d,chroma:P,coord:M,oct:s}}(e)):p(e)?C(function(e){var t=e.step,n=e.alt,a=e.oct,r=void 0===a?0:a,i=e.dir;if(!i)return"";var o=t+1+7*r,m=i<0?"-":"",c="M"===q[t]?"majorable":"perfectable";return m+o+function(e,t){return 0===t?"majorable"===e?"M":"P":-1===t&&"majorable"===e?"m":t>0?J("A",t):J("d","perfectable"===e?t:t+1)}(c,n)}(e)):f(e)?C(e.name):O}var R=[0,2,4,5,7,9,11],q="PMMPPMM";var J=function(e,t){return Array(Math.abs(t)+1).join(e)};function B(e,t){var n=t.length,a=(e%n+n)%n;return t.slice(a,n).concat(t.slice(0,a))}var D={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},F=function(e){return Number(e).toString(2)},G=function(e){return parseInt(e,2)},$=/^[01]{12}$/;function z(e){return $.test(e)}var I=function(e){return"number"===typeof e&&e>=0&&e<=4095},K=function(e){return e&&z(e.chroma)},L=Object(M.a)({},D.chroma,D);function U(e){var t=z(e)?e:I(e)?F(e):Array.isArray(e)?function(e){if(0===e.length)return D.chroma;for(var t,n=[0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<e.length;a++)(t=w(e[a])).empty&&(t=C(e[a])),t.empty||(n[t.chroma]=1);return n.join("")}(e):K(e)?e.chroma:D.chroma;return L[t]=L[t]||function(e){var t=G(e),n=function(e){var t=e.split("");return t.map(function(e,n){return B(n,t).join("")})}(e).map(G).filter(function(e){return e>=2048}).sort()[0],a=F(n),r=function(e){for(var t=[],n=0;n<12;n++)"1"===e.charAt(n)&&t.push(W[n]);return t}(e);return{empty:!1,name:"",setNum:t,chroma:e,normalized:a,intervals:r}}(t)}var W="1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");Object(r.a)({},D,{intervals:[],aliases:[]});var X=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 7m","whole tone"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2m 3m 3M 5d 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished"],["1P 2M 3M 4P 5P 6m 7m","melodic minor fifth mode","hindu","mixolydian b6M"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","melodic minor second mode"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major","dorian b2"],["1P 2M 3m 4P 5P 6m 7m","aeolian","minor"],["1P 2M 3m 5d 5P 6M 7m","romanian minor"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","ionian augmented"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M","chromatic"]].map(function(e){var t=Object(P.a)(e),n=t[0],a=t[1],i=t.slice(2),o=n.split(" ");return Object(r.a)({},U(o),{name:a,intervals:o,aliases:i})}),Y=X.reduce(function(e,t){return e[t.name]=t,e[t.setNum]=t,e[t.chroma]=t,t.aliases.forEach(function(n){e[n]=t}),e},{});Object.keys(Y);var H=n(25),Q=n(4),V=n(26),Z=n(27),_=10,ee=10;function te(e,t,n){return Math.max(Math.min(e,n),t)}function ne(e){var t=e.currentTarget.getBoundingClientRect();return{x:te(e.pageX-(t.x+window.scrollX),0,t.width),y:te(e.pageY-(t.y+window.scrollY),0,t.height)}}function ae(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y);return{left:t,top:n,width:Math.max(e.start.x,e.end.x)-t,height:Math.max(e.start.y,e.end.y)-n}}function re(e){var t=e.midi,n=e.extents,a=e.track,o=e.trackIdx,c=e.tracksWidth,u=e.midiRange,s=e.selectedNotes,P=e.setSelectedNotes,M=m.a.useRef({start:{x:0,y:0},end:{x:0,y:0},dragging:!1}),f=m.a.useRef(null);function p(){var e=f.current,t=M.current;if(e&&t){e.style.visibility=t.dragging?"visible":"hidden";var n=ae(t);e.style.left=n.left+"px",e.style.top=n.top+"px",e.style.width=n.width+"px",e.style.height=n.height+"px"}}var h=m.a.useCallback(function(e){return{left:e.ticks/t.header.ppq*ee,top:(u-(e.midi-n.minNote))*_,width:e.durationTicks/t.header.ppq*ee,height:_}},[t.header.ppq,n.minNote,u]),y=m.a.useCallback(function(){var e=M.current;if(e){var t=ae(e),n=a.notes.filter(function(e){return function(e,t){var n=e.left,a=e.top,r=e.left+e.width,i=e.top+e.height,o=t.left,m=t.top,c=t.left+t.width,l=t.top+t.height;return!(n>c||o>r||a>l||m>i)}(h(e),t)});P(new Set(n))}},[a,h]),v=m.a.useCallback(function(e){M.current={start:ne(e),end:ne(e),dragging:!0},p()},[]),b=m.a.useCallback(function(e){var t=M.current;t&&t.dragging&&(t.end=ne(e),p())},[]),g=m.a.useCallback(function(){var e=M.current;e&&e.dragging&&(e.dragging=!1,y()),p()},[y]);return m.a.createElement("div",{onMouseDown:v,onMouseMove:b,onMouseUp:g,onMouseLeave:g,style:{height:(u+1)*_+1,width:c,position:"relative",borderBottom:"solid #555 1px"}}," ",Object(i.a)(Array(u+1).keys()).map(function(e){var t=u-e+n.minNote,a=d.a(t);return m.a.createElement("div",{key:"track"+o+"row"+e,style:{height:_,background:""===l.b(a).acc?"darkgrey":"grey",borderTop:"solid #555 1px",overflow:"hidden"}},m.a.createElement("div",{style:{marginTop:-1,fontSize:9,fontFamily:"Lucida Grande"}},a))}),a.notes.map(function(e,t){return m.a.createElement("div",{key:"track"+o+"note"+t,style:Object(r.a)({},h(e),{background:s.has(e)?"red":"#459",border:"solid 1px darkblue ",position:"absolute"})})}),m.a.createElement("div",{ref:f,style:{background:"rgba(200,200,200,0.3)",border:"solid 1px white",position:"absolute"}}))}function ie(e){var t=e.midi,n=e.selectedNotes,a=e.setSelectedNotes,r=m.a.useMemo(function(){return t.tracks.map(function(e){return 0===e.notes.length?{minNote:0,maxNote:0,maxTicks:0}:e.notes.reduce(function(e,t){return{minNote:Math.min(e.minNote,t.midi),maxNote:Math.max(e.maxNote,t.midi),maxTicks:Math.max(e.maxTicks,t.ticks+t.durationTicks)}},{minNote:127,maxNote:0,maxTicks:0})})},[t.tracks]),i=m.a.useMemo(function(){return r.reduce(function(e,t){return Math.max(t.maxTicks,e)},0)/t.header.ppq*ee},[r,t.header.ppq]);return m.a.createElement("div",{style:{textAlign:"left"}},t.tracks.map(function(e,o){var c=r[o],l=c.maxNote-c.minNote;return m.a.createElement("details",{key:o,open:!0},m.a.createElement("summary",null,"Track ",o+1),m.a.createElement(re,{midi:t,extents:c,track:e,trackIdx:o,tracksWidth:i,midiRange:l,selectedNotes:n,setSelectedNotes:a}))}))}n.d(t,"default",function(){return fe});var oe=["C","C#","D","D#","E","F","F#","G","G#","A","Bb","B"],me=["major","minor","dorian","lydian","phrygian","ionian","mixolydian","locrian"],ce=4,le=144,ue=128,se=80;function de(e){var t=e.scaleData,n=e.selectedNotes,a=e.notePlayer,r=Object(i.a)(new Set(Object(i.a)(n).map(function(e){return l.b(e.name).pc}))),o=t.keyScales.filter(function(e){var t=!0,n=!1,a=void 0;try{for(var i,o=r[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var m=i.value;return!!e.notes.includes(m)}}catch(c){n=!0,a=c}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}});return m.a.createElement("div",null,m.a.createElement("div",null,"Notes: ",r.join(", ")),m.a.createElement("div",null,"Matching Scales:",m.a.createElement("br",null)," ",o.map(function(e){var t=Pe(e,ce);return m.a.createElement("div",{key:e.name},e.name,m.a.createElement("br",null),m.a.createElement(Z.a,{highlightKeys:t,startOctave:ce,octaves:3,highlightType:"scale",notePlayer:a}))})))}function Pe(e,t){return e.intervals.map(function(n){return l.d("".concat(e.tonic).concat(t),n)})}function Me(e,t,n){var a=Pe(u.a("".concat(e," ").concat(t)),n),i=X.slice().map(function(t){return u.a("".concat(e," ").concat(t.name))}).map(function(e){return Object(r.a)({},e,{notesAbstractMidi:new Set(e.notes.map(function(e){return l.b("".concat(e,"0")).midi}).sort())})});return{scaleNotes:a,key:e,keyScales:i}}function fe(e){var t=e.audioApi,n=function(){var e=Object(H.a)("MidiExploderPersistence",null),t=Object(a.a)(e,2),n=t[0],r=t[1];return[m.a.useMemo(function(){if(null!=n)try{var e=new c.Midi;return e.fromJSON(n),e}catch(t){return console.error("failed to load midi file",t),null}},[n]),function(e){r(e.toJSON())}]}(),r=Object(a.a)(n,2),i=r[0],o=r[1],u=Object(Q.b)("key","C",Q.a.string),d=Object(a.a)(u,2),P=d[0],M=d[1],f=Object(Q.b)("scaleType","major",Q.a.string),p=Object(a.a)(f,2),h=p[0],y=p[1],v=m.a.useCallback(function(e){if(e.currentTarget.files){var t=Object(a.a)(e.currentTarget.files,1)[0];if(t){var n=new FileReader;n.onload=function(){o(new c.Midi(n.result))},n.readAsArrayBuffer(t)}}},[o]),b=m.a.useMemo(function(){return Me(P,h,ce)},[P,h]),g=m.a.useState(null),A=Object(a.a)(g,2),k=A[0],x=A[1],j=m.a.useCallback(function(){x({keys:b.scaleNotes,type:"scale"})},[b]);Object(V.a)(b,j);var w=m.a.useMemo(function(){return t.dx7?function(e){return t.dx7.onMidi(e)}:function(e){}},[t]),E=m.a.useMemo(function(){return{triggerAttack:function(e){w([le,l.b(e).midi,se])},triggerRelease:function(e){w([ue,l.b(e).midi,se])}}},[w]),N=m.a.useState(new Set),O=Object(a.a)(N,2),S=O[0],T=O[1];return m.a.createElement("div",{className:"App"},m.a.createElement("label",null,"midi file: ",m.a.createElement("input",{type:"file",onChange:v})),m.a.createElement("div",{onMouseOver:j},m.a.createElement("label",null,"key:"," ",m.a.createElement("select",{value:b.key,onChange:function(e){return M(e.currentTarget.value)}},oe.map(function(e){return m.a.createElement("option",{key:e,value:e},e)})))," ",m.a.createElement("label",null,"scale type:"," ",m.a.createElement("select",{value:h,onChange:function(e){return y(e.currentTarget.value)}},me.map(function(e){return m.a.createElement("option",{key:e,value:e},e)})))," ",m.a.createElement("label",null,"scale notes: "),b.scaleNotes.map(function(e){return s.b(e)}).join()," "),m.a.createElement(Z.a,{highlightKeys:k?k.keys:null,startOctave:ce,octaves:3,highlightType:k?k.type:"scale",notePlayer:E}),m.a.createElement("details",{open:!1,style:{textAlign:"left"}},m.a.createElement("summary",null,"JSON"),m.a.createElement("pre",null,i&&JSON.stringify(i.toJSON(),null,2))),null!=i&&m.a.createElement("div",{style:{display:"flex"}},m.a.createElement("div",{style:{overflow:"hidden",width:"66%"}},m.a.createElement(ie,Object.assign({midi:i},{selectedNotes:S,setSelectedNotes:T}))),m.a.createElement("div",{style:{width:"33%",overflow:"hidden"}},m.a.createElement(de,{scaleData:b,selectedNotes:S,notePlayer:E}))))}}}]);
//# sourceMappingURL=5.820b4fd5.chunk.js.map